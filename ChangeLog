2005-10-24  Francois Marier  <francois@serioushack.com>

	* src/ShSyntax.hpp (SH_UNTIL): The condition should be negated
	since the loop becomes a do..while loop in immediate mode.

	* src/ShParser.cpp (parseDo): Add an extra node between the body
	and the condition evaluation so that SH_CONTINUE can jump there
	and evaluate the condition again instead of jumping back to the
	start of the body.

2005-10-21  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbCode.cpp (allocTemps): Reorder the write mapping
	and the read check in the register allocator to fix a problem
	where a variable that has been written to in the scope will not be
	reused later on in the same scope.

2005-10-20  Francois Marier  <francois@serioushack.com>

	* src/ShSyntax.cpp, ShSyntax.hpp: Add a boolean parameter to both
	shBreak() and shContinue().

	* src/ShParser.cpp, ShParser.hpp: Add a stack which keeps track of
	the break and continue points for each scope.
	Add parse_break() and parse_continue() to generate the right
	control flow graphs when using SH_BREAK and SH_CONTINUE.

	* src/ShParser.hpp, ShCtrlGraph.cpp: Turn ShParser into a
	singleton.

2005-10-19  Francois Marier  <francois@serioushack.com>

	* src/ShProgramNode.cpp (compile): Remove the check for stream
	programs because on some backends (e.g. cc) it makes sense to
	compile a stream program.

	* backends/gl/GlBackend.cpp (generate_code): Prevent code
	generation for stream programs and display a warning.

2005-10-17  Stefanus Du Toit  <sdt@serioushack.com>

	* src/ShDllExport.hpp: Don't define SH_DLLEXPORT if it already
	is. Fixes the build on win32.

2005-10-14  Francois Marier  <francois@serioushack.com>

	* src/ShDllExport.hpp: Define the SH_DLLEXPORT macro for the gcc
	visibility feature.  Define a new SH_DLLLOCAL macro to be used for
	explicitely hiding functions and methods.

	* backends/gl/ArbCode.cpp (ArbCode): Throw an error when creating
	an ArbCode object with an unit type other than vertex or fragment.

	* src/ShProgramNode.cpp (compile): Ignore compilations of stream
	programs and output a warning.

	* src/ShSyntax.cpp (shCompile): Move duplicated code into a single
	generic function.

2005-10-07  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.cpp, GlslCode.hpp
	(bind_generic_attributes): Add this method to be called before
	linking the glsl program.  It binds all attributes to the index
	they were assigned to earlier.
	(generate): Pass the original variables to the variable map so
	that it can edit the user-facing metadata.

	* backends/gl/GlslSet.cpp: Bind all generic vertex attributes when
	a vertex shader is bound.
	
	* backends/gl/GlslVariable.hpp, GlslVariable.cpp: The m_attribute
	member variable now keeps track of the index where vertex
	attributes are located.

	* backends/gl/GlslVariableMap.cpp: Refactor
	allocate_generic_vertex_inputs() to use the new
	allocate_generic_vertex_input() method which assign an index to
	the variable and change its user-facing metadata.
	Add m_original_vars to constructor and destructor.

	* backends/gl/GlslVariableMap.hpp: Add the
	allocate_generic_vertex_input() method.  
	Keep a copy of the original variables to change their metadata.

2005-10-06  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.hpp, GlslCode.cpp, GlslVariableMap.cpp,
	GlslVariableMap.hpp: Print the original Sh name when declaring
	variables.

	* backends/gl/ArbCode.cpp: Print an error message when an input
	cannot be bound to any built-in variables (semantic binding).

2005-09-30  Francois Marier  <francois@serioushack.com>

	* src/ShProgramNode.hpp, ShProgramNode.cpp, ShProgram.hpp,
	ShVariableNode.cpp, backends/gl/Utils.cpp, GlslVariableMap.cpp,
	PBufferStreams.cpp, GlslCode.cpp, ArbCode.cpp, backends/cc/Cc.cpp:
	Renamed the iterators according to the names used in the book.

	* util/ShPngImage.hpp, ShPngImageImpl.hpp, ShPngImage.cpp: Move
	all libpng code to a cpp file so that nobody but Sh will need to
	include the libpng and zlib headers.

	* src/ShProgramNode.cpp, ShProgramNode.hpp
	(collect_dependent_uniform): Add this method to support the
	collection of dependent uniforms' dependent uniforms.
	(collectNodeDecls, collectVar, collectNodeVars): Rename some
	private methods to match new coding standards
	
2005-09-29  Francois Marier  <francois@serioushack.com>

	* src/ShProgramNode.hpp, ShProgramNode.cpp, ShProgram.hpp: Add
	all_uniforms_begin() and all_uniforms_end() to return all
	uniforms, including recursively dependent ones.

	* src/ShProgramNode.cpp (describe_interface): Display all uniforms
	instead of just iterating through uniforms_begin().

2005-09-27  Francois Marier  <francois@serioushack.com>

	* util/ShPngImage.hpp, ShPngImageImpl.hpp, shutil.hpp,
	src/ShImage.hpp, src/ShImageImpl.hpp, src/ShImage.cpp: Move the
	PNG stuff to util.  Make load_PNG, save_PNG and save_PNG16 free
	functions instead of ShImage methods.

2005-09-23  Francois Marier  <francois@serioushack.com>

	* src/ShSyntax.hpp: Add the namespace qualifier to ShContext so
	that it's not necessary to be using the SH namespace before using
	SH_IF or any other control flow macro.

	* backends/gl/GlslVariable.cpp, GlslVariable.hpp (attribute): Add
	this method to set the name of the variable and make it an
	attribute (with the new m_attribute bool).

	* backends/gl/GlslVariableMap.cpp, GlslVariableMap.hpp
	(allocate_generic_vertex_inputs): Add this method and call it
	instead of allocate_builtin_inputs() when the "opengl:matching"
	meta tag is set to "generic".  It uses the attribute facility in
	Glsl instead of using the built-in attribute names (like
	gl_Position).
	(attribute_begin, attribute_end): Add these methods to allow the
	code generation to declare attributes at the top of the code.

	* backends/gl/GlslCode.cpp (print): Declare attributes at the top
	of the source file.

	* backends/gl/GlslVariableMap.cpp (GlslVariableMap),
	ArbCode.cpp (ArbCode): Remove the hard-coded number of maximum
	draw buffers and get it through OpenGL's glGet instead.

2005-09-22  Francois Marier  <francois@serioushack.com>

	* backends/gl/PBufferStreams.cpp (execute): Only display the
	warning about intermediate streams once per process.

	* backends/gl/ArbCode.cpp, GlslCode.cpp (genStructNode): Don't
	check for the size of the successor in IF blocks, it prevents
	perfectly valid code (e.g. nested IFs inside another IF) from
	being generated.

2005-09-21  Francois Marier  <francois@serioushack.com>

	* src/ShLibClampImpl.hpp, ShLibClamp.hpp: Rename smoothstep() to
	linstep() and cubicstep() to smoothstep().  This is done to be
	consistent with RenderMan.

2005-09-16  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslEmit.cpp (emit_discard): Implement SH_OP_RET.

	* backends/gl/GlslCode.hpp (emit_discard): Add a string parameter
	to select the function to call.

	* src/ShSyntax.cpp: Add the SH_RETURN statement.

	* src/ShTypeConvertTransformer.cpp: Add SH_OP_RET to the switch
	statement.

	* src/ShTextureNode.cpp (build_mipmaps): Add a check to avoid
	building the mipmaps when the texture is set to a specific texid.

2005-09-15  Francois Marier  <francois@serioushack.com>

	* src/ShNibblesImpl.hpp, ShNibbles.hpp: Add a nibbles for bezier
	and hermite.

	* src/ShLibSplines.hpp, ShLibSplinesImpl.hpp: Move bezier to the
	core and fix it so that it actually compiles.
	Add a dummy function for hermite.

	* util/ShFunc.hpp, ShFuncImpl.hpp: Remove bezier from util.
	Remove broken hashlcg() function.
	
	* src/ShLibClampImpl.hpp, ShLibClamp.hpp (cubicstep): Add
	cubicstep to the core.

	* util/ShFuncImpl.hpp, ShFunc.hpp (deprecated_smoothstep): Remove
	this function since it's been renamed and moved to the core.

2005-09-14  Francois Marier  <francois@serioushack.com>

	* src/ShConcreteCTypeOp.cpp, ShConcreteRegularOpImpl.hpp,
	ShTranformer.cpp, backend/cc/CcEmit.cpp: Reverse the parameters of
	atan2().

	* src/ShLibSplinesImpl.hpp, ShLibSplines.hpp (bernstein): Add this
	function to the core.  This is a dummy function for anything other
	than N=4.

	* src/ShNibblesImpl.hpp, ShNibbles.hpp (shBernstein): Add this
	nibble.

	* src/ShLib.hpp: Include the splines functions header.

	* util/ShFuncImpl.hpp: Remove the old version of
	bernstein_basis_4.

2005-09-09  Francois Marier  <francois@serioushack.com>

	* src/ShImage.hpp, ShImageImpl.hpp, ShImage.cpp,
	examples/textures/main.cpp: Rename loadPng, savePng, savePng16,
	load_png and save_png to load_PNG, save_PNG and save_PNG16.

2005-09-07  Francois Marier  <francois@serioushack.com>

	* src/ShNibblesImpl.hpp, ShNibbles.hpp: Add nibbles for discard()
	and groupsort<S>().

2005-08-30  Stefanus Du Toit  <sdt@serioushack.com>

	* src/FixedManipulator.cpp (operator&): Allow empty manipulators.
	Might need to be done elsewhere also.

	* backends/gl/ArbCode.cpp: Do not use the same destination register
	when updating conditional registers on NV. Fixes branches based on
	uniforms, which cannot be assigned to.

	* src/ShNibblesImpl.hpp: Remove extra default parameters in
	function definitions. Fixes build with MSVC7.
	
2005-08-26  Francois Marier  <francois@serioushack.com>

	* src/ShNibblesImpl.hpp, ShNibbles.hpp: Added nibbles for
	faceforward, lit, reflect, refract, sat, ceil, floor, round, sign,
	sort, not, and, or, any, all, max1, min1, clamp, cond, smoothstep,
	smoothpulse and join.
	Fixed the nibbles for prod, sum and mad.

	* src/ShLibClampImpl.hpp (smoothpulse): Changed sstep() calls to
	use smoothstep().

	* src/ShProgramNode.hpp, ShProgram.hpp (backend_name): Add this
	method to retrieve the backend name on which the program is
	currently compiled.

	* src/ShProgramNode.cpp (compile): Set the backend name when
	compiling the program.
	(ShProgramNode): Initialize the backend name to "".

2005-08-25  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbReg.cpp, ArbReg.hpp (binding_name): Add this
	method to return the actual name of the Arb variable.

	* backends/gl/ArbCode.cpp (describe_bindings): Implementation of
	describe_bindings() in the Arb backend.

	* backends/gl/GlslCode.cpp (describe_bindings): Implementation of
	describe_bindings() in the Glsl backend.

	* src/ShProgramNode.cpp (describe_bindings): Add a little header
	before outputing the backend information.

2005-08-24  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslVariable.cpp, GlslVariable.hpp: Add the draw
	buffer variable (gl_FragData[]) to the built-in output variables.
	
	* backends/gl/GlslVariableMap.cpp (GlslVariableMap): Enable the
	the draw buffers extension if it's available.

	* backends/gl/ArbCode.cpp (ArbCode): The ATI_draw_buffers
	extension is also known as ARB_draw_buffers so check for both.
	
	* backends/gl/GlslEmit.cpp, GlslCode (emit_exp10): Replace the
	call to pow by a multiplication.
	(emit_log10): Replace the division by a multiplication.
	(emit_log, emit_exp): Remove these functions and use the built-in
	exp and log functions instead.

	* backends/gl/GlslEmit.cpp (table_substitution): Remove
	unnecessary casts when the destination variable is the same size
	as the source (in the case of assignments) or the result of the
	function call.

	* backends/gl/PBufferStreams.cpp: Use the target of the stream
	program to come out with the proper target for vertex and fragment
	programs (e.g. if the stream program's target is "glsl:stream"
	then the other targets should be "glsl:vertex" and "glsl:fragment")

	* src/ShProgramNode.cpp, ShProgramNode.hpp, ShProgram.hpp
	(describe_bindings): Add the two versions of describe_bindings().
	They call the backend functions and return the backend-specific
	binding info.

	* src/ShBackend.hpp (describe_bindings): Add this new pure virtual
	method.
	
	* backends/gl/GlslCode.cpp, GlslCode.hpp, ArbCode.cpp,
	ArbCode.hpp, backends/cc/Cc.cpp, Cc.hpp (describe_bindings): Add
	empty implementations of describe_bindings() for all three
	backends.

2005-08-23  Francois Marier  <francois@serioushack.com>

	* backends/cc/Cc.cpp (generate): On OSX, define exp10() in the
	prologue of generated programs.

	* src/ShMath.hpp: Add exp10() on OSX.

	* src/ShBackend.cpp, ShBackend.hpp (derived_targets): Go through
	all installed backends when making a list of derived targets.
	(check_target): Add this method.
	(target_handler): Move the backend loading to load_backends().

	* src/ShGeneric.hpp: Add typedefs like the ones availabled in
	ShAttrib (e.g. ShGeneric2f, ShGeneric4fub, etc.).

	* src/ShImage.hpp: Make ShPngImage a DLL-exported class.

2005-08-22  Francois Marier  <francois@serioushack.com>

	* src/ShImage.hpp, ShImageImpl.hpp, ShImage.cpp: Move all libpng
	code into a non-templated class to reduce the libpng dependency.
	Remove the DLL_EXPORT tag so that it compiles on Windows.

	* src/ShImageImpl.hpp, ShImage.hpp: Rename ShImageNode to
	ShTypedImage.

2005-08-19  Francois Marier  <francois@serioushack.com>

	* src/ShMemory.cpp (ShHostHostTransfer::transfer): Only check that
	sizes match when the types are the same.

	* src/ShTextureNode.cpp (build_mipmaps): Make a float copy of the
	base storage so that mipmaps can be built from a non-float
	texture.
	
	* src/ShImage.hpp, ShImageImpl.hpp, ShImage.cpp: Rename ShImage
	into ShImageNode and template it so that fub images can be created
	fron PNG files for example.  Make ShImage a typedef of
	ShImageNode<float> for backwards compatibility.

2005-08-17  Francois Marier  <francois@serioushack.com>

	* src/ShTransformer.cpp (struct ATan2ExpanderBase): Fix issues
	related to negative values and zeroes in atan2().

2005-08-17  Andrew Lauritzen  <atlaurit@student.cs.uwaterloo.ca>

	* src/ShBaseTexture.hpp: Added a method to access the node that a
	texture refers to.

2005-08-16  Francois Marier  <francois@serioushack.com>

	* src/ShTextureNode.cpp (memory): Must reinitialize memories
	whenever the base level is modified.

	* src/ShTextureNode.hpp, ShTextureNode.cpp (build_mipmaps): Add
	some checks to skip rebuilding the mipmaps when it's not necessary
	and return a boolean to indicate whether they were rebuilt or
	not.

	* backends/gl/GlTextures.cpp (bindTexture): Always call
	build_mipmaps() since it includes the necessary checks now.

2005-08-15  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.hpp, GlslCode.cpp (resolve): Cast the
	argument to the proper size if necessary.

	* backends/gl/GlslEmit.cpp (table_substitution): Make use of the
	new resolve method to avoid casting arguments unnecessarily.

	* backends/gl/GlslEmit.cpp, GlslCode.hpp (emit_pow): Add this
	method to emit pow operations and properly cast both the result
	and the arguments.

	* backends/gl/GlslEmit.cpp (emit_exp, emit_cbrt, emit_hyperbolic):
	Make use of emit_pow to do the necessary casts.

	* src/ShTextureNode.cpp (initialize_memories): Make sure the
	mipmap levels are always >= 1.

2005-08-12  Francois Marier  <francois@serioushack.com>

	* src/ShBackend.cpp: Changed some more iterators to be 64-bit
	safe.

2005-08-11  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslEmit.cpp (GlslOpCodeVecs), 
	backends/cc/CcEmit.cpp (CcOpCodeVecs),
	src/ShBackend.cpp (load_libraries): 
	Change size of iterators to be size_t so that it works on 64-bit
	machines.

2005-08-11  Andrew Lauritzen  <atlaurit@student.cs.uwaterloo.ca>

	* src/ShNibblesImpl.hpp: Fixed a minor compilation error on
	windows to do with redefinition of default parameters.
	
	* src/ShRecord.cpp: Removed some unnecessary debug spew.

2005-08-10  Francois Marier  <francois@serioushack.com>

	* src/ShNibblesImpl.hpp, ShNibbles.hpp: Add nibbles for gradient,
	cellnoise, scellnoise, hash, texhash, linnoise, slinnoise, noise,
	snoise, perlin, sperlin, turbulence, sturbulence, poly, cross,
	length, length_1, length_inf, distance, distance_1, distance_inf.

2005-08-09  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlTextures.cpp (shGlInternalFormat): Add a warning
	about the lack of float textures.  Fallback on byte textures.

2005-08-08  Francois Marier  <francois@serioushack.com>

	* src/ShNibblesImpl.hpp, ShNibbles.hpp: Add nibbles for exp,
	expm1, exp2, exp10, log, logp1, log2, log10, cbrt, rsqrt prod,
	sum, rcp, atan2, atan, mad, sinh, cosh, tan, tanh, asinh, acosh,
	atanh, dx, dy and fwidth.
	Add macros for ternary operations.
	
2005-08-04  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbEmit.cpp (emit_sgn): Optimized the sign operation
	on Arb by removing one addition (Will's idea).

	* src/ShNibblesImpl.hpp, ShNibbles.hpp: Rename the nibbles so that
	they match the book.

2005-08-03  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbEmit.cpp (emit_sgn): Fix the sign(0) case without
	using DIV or COND.

	* backends/gl/ArbEmit.cpp, ArbCode.hpp (emit_atan): Implement ATAN.

2005-08-02  Francois Marier  <francois@serioushack.com>

	* src/ShLibMiscImpl.hpp (cast): Make sure all components are
	initialized to zero to avoid problems in some environments.

2005-07-27  Andrew Lauritzen  <atlaurit@student.cs.uwaterloo.ca>

	* src/ShMatrix.hpp: Added "rows" and "cols" static variables to
	ShMatrix set to the corresponding template parameters.

2005-07-27  Stefanus Du Toit  <sdt@serioushack.com>

	* src/ShOptimizations.cpp: Added redundant edge removal optimization.
	
	* src/ShLibMatrixImpl.hpp: Add hack for MSVC which cannot handle
	as beefy template matching as gcc, in particular for operator| and
	operator* for matrices with special types.
	
	* src/ShLibMatrix.hpp: Remove #ifndef WIN32 which for some strange
	reason was there.
	
2005-07-27  Francois Marier  <francois@serioushack.com>

	* src/ShLibMatrixImpl.hpp (operator|): Support non-square matrices
	in the expanded matrix-tuple products.

	* src/ShLibMiscImpl.hpp, ShLibMisc.hpp (join): Add support for
	scalars in the 2-argument version of join.

	* src/ShLibArithImpl.hpp (lerp): Fix the support for scalars.
	(mad): Fix the support for scalars.
	
	* src/ShLibMatrixImpl.hpp, ShLibMatrix.hpp: Optimize the
	matrix-tuple product for SH_VECTOR and SH_NORMAL.  
	Make the matrix-tuple expansion work as intended by returning the
	same semantic type and size as the argument.

2005-07-27  Stefanus Du Toit  <sdt@serioushack.com>

	* src/ShOptimizations.cpp: Added empty block removal optimization,
	enabled by default.
	
	* src/ShStructural.hpp: Removed comment about IF being unused cause
	it isn't anymore.
	
	* src/ShStructural.cpp: Handle IF nodes.
	
	* backends/gl/ArbCode.cpp: Handle IF nodes in structural analysis.
	
	* backends/gl/GlslCode.cpp: Handle IF nodes in structural analysis.
	
2005-07-26  Francois Marier  <francois@serioushack.com>

	* src/ShLibBooleanImpl.hpp, ShLibBoolean.hpp (cond): Adding a
	version of cond where the first parameter doesn't have to be an Sh
	type.

	* src/ShLibNormal.hpp, ShLibPoint.hpp, ShLibVector.hpp,
	ShLibTexCoord.hpp: Remove unnecessary expansion methods.

	* src/ShLibMatrixImpl.hpp, ShLibMatrix.hpp (operator|): Add
	tuple-expansion for this operator as well.
	
	* src/ShLibMatrixImpl.hpp, ShLibMatrix.hpp (operator*): Add tuple
	expansion for matrix-tuple multiplication of certain semantic
	types.

	* backends/gl/ArbEmit.cpp (emit_tex): Fix a bug in the
	LUMINANCE_ALPHA special case so that texture lookups work with
	2-component variables.

2005-07-25  Francois Marier  <francois@serioushack.com>

	* src/ShLibNoise.hpp, ShLibNoiseImpl.hpp: Add a dummy texhash()
	function (it just calls hash() right now).

2005-07-22  Francois Marier  <francois@serioushack.com>

	* src/ShOperation.hpp, ShOperation.cpp: Add IR operations for the
	inverse hyperbolic functions.

	* src/ShLibTrigImpl.hpp, ShLibTrig.hpp, ShInstructions.hpp: Add
	library functions for the inverse hyperbolic functions.

	* src/ShTransformer.hpp, ShTransformer.cpp: Add implementations
	for the inverse hyperbolic functions and for ATAN2.
	
	* backends/cc/CcEmit.cpp, src/ShConcreteCTypeOp.cpp,
	ShConcreteRegularOpImpl.hpp: Fix the ATAN2 mapping to agree with
	the book.

	* src/ShConcreteCTypeOpImpl.hpp, ShEvalImpl.hpp,
	ShConcreteCTypeOp.cpp backends/cc/CcEmit.cpp, ShInstructions.cpp,
	ShConcreteRegularOpImpl.hpp: Add mappings for the inverse
	hyperbolic functions.
	
	* backends/gl/ArbCode.cpp, GlslCode.cpp (generate): Call the
	tranformers to expand ATAN2 and the inverse hyperbolic functions.

	* src/ShTransformer.cpp (struct DummyOpStripperBase): Fix the
	dummy op stripper so that the changes are not ignored (m_changed =
	true).
	
2005-07-21  Francois Marier  <francois@serioushack.com>

	* src/ShLibNoise.hpp: Add the hash() function and move cellnoise
	and scellnoise in the same section.

	* src/ShLibNoiseImpl.hpp: Add hash() and rename all calls to
	hashmrg() to calls to the new function. 

	* src/ShOperation.cpp, ShOperation.hpp, ShEvalImpl.hpp: Add the
	NOISE and HASH IR operations.

	* src/ShInstructions.cpp, ShInstructions.hpp: Add shHASH().

	* src/ShConcreteCTypeOpImpl.hpp, ShConcreteRegularOpImpl.hpp: Add
	dummy implementations for NOISE and HASH.

	* backends/gl/GlslEmit.cpp, GlslCode.hpp: Add a real
	implementation of the NOISE IR operation using the noise[1234]()
	glsl function.
	
	* util/ShFunc.hpp, ShFunc.cpp: Remove hashmrg() since it has been
	moved into the core.
	
2005-07-20  Francois Marier  <francois@serioushack.com>

	* src/ShLibNoise.hpp, ShLibNoiseImpl.hpp: Add dummy
	implementations of noise(), snoise(), linnoise() and slinnoise().

	* src/ShLibWorleyImpl.hpp (operator()): Remove frac() since issue58
	is resolved.

	* src/ShLib.hpp: Add ShLibNoise.hpp and ShLibWorley to the include
	list.

	* src/ShGenericImpl.hpp, ShBaseTextureImpl.hpp: Remove the
	unnecessary include of ShLib.hpp.
	
	* src/ShMatrixImpl.hpp: Include ShLibMisc.hpp.
	
	* src/ShLibMisc.hpp, ShLibGeometry.hpp, ShLibMatrix.hpp,
	ShLibArith.hpp, ShLibClamp.hpp, ShLibTrig.hpp, ShLibDeriv.hpp,
	ShLibBoolean.hpp: Move the ShLib.hpp include before the header
	guard to guarantee that the file will be included by ShLib.hpp,
	not the other way around.  This is necessary because some macros
	are undefined by ShLib.

	* src/ShLibMiscImpl.hpp: Move sort() after groupsort() since
	sort() calls groupsort().

	* src/ShLibWorley.hpp, ShLibWorleyImpl.hpp, ShLibNoise.hpp,
	ShLibNoiseImpl.hpp: Create these files from the related files
	under util/.

	* ShNoiseImpl.hpp, ShWorleyImpl.hpp, shutil.hpp, ShNoise.hpp,
	ShWorley.hpp, Makefile.am: Remove the noise and worley code since
	it is now part of the core.
	
2005-07-12  Andrew Lauritzen  <atlaurit@student.cs.uwaterloo.ca>

	* src/ShInternals.*: Add a utility class for tracking variable
	transformations (while compiling, etc).

	* backends/gl/ArbCode.hpp: Added "generic" binding support for
	vertex shader inputs if requested (by metadata). Resolves issue100
	for the ARB backend.

2005-07-12  Stefanus Du Toit  <sdt@serioushack.com>

	* src/ShLibGeometry.hpp: Document sane convention for
	refract() parameters.

	* src/ShLibGeometryImpl.hpp: Change refract() to conform to a
	sane convention for its inputs. Resolves issue200.
	
	* backends/gl/ArbEmit.cpp: Better implementation of SGN.

2005-07-12  Andrew Lauritzen  <atlaurit@student.cs.uwaterloo.ca>

	* src/ShProgramNode.cpp (clone): Cloning ShProgramNodes now copies
	metadata.

2005-07-08  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.cpp (real_update_uniform): Removing the
	unknown uniform message.

	* util/ShNoiseImpl.hpp (turbulence): Add a missing return
	statement.

	* backends/gl/GlslVariableMap.cpp (GlslVariableMap): Allocate
	GlslVariables for the uniforms.

	* backends/gl/PBufferStreams.cpp (execute): Only print the
	fragment program when SH_DEBUG_PBS_PRINTFP is defined.

	* src/ShAlgebra.cpp (connect): Add a missing collectVariables().
	(combine): Add a missing collectVariables().

2005-07-07  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbCode.cpp: Map result.depth to SH_POSITION
	variables only to avoid generic mappings.

	* add_libsh_copyright_notice.pl, COPYING, *.cpp, *.hpp: Change the
	license and copyright notices to the GNU LGPL.
	
	* src/ShException.cpp, ShException.hpp: Make ShException inherit
	from std::exception and add a what() method so that ShExceptions
	can be handled in the same way as regular C++ exceptions.

2005-07-06  Francois Marier  <francois@serioushack.com>

	* src/ShTextureNode.cpp, ShTextureNode.hpp (build_mipmaps): Only
	build one face of the cube map at a time (takes an extra optional
	parameter).
	Fix the base memory pointer for cube maps.

	* backends/gl/GlTextures.cpp (bindTexture): Give the proper target
	for cube map mipmap levels.

2005-07-05  Francois Marier  <francois@serioushack.com>

	* src/ShTextureNode.cpp (initialize_memories): Make a copy of all
	the base textures (one per face for cube maps).

	* src/ShTextureNode.hpp: Remove the (now) useless base_memory
	parameter.

	Adding mipmapping support in ShTextures:
	
	* backends/gl/GlTextureStorage.cpp: Specify the mipmap level when
	transfering textures to the graphics card.
	Add the mipmap_level parameter to the constructor.

	* backends/gl/GlTextureStorage.hpp: Add a mipmap_level parameter
	to the constructor.
	Add the mipmap_level() method.
	Add the m_mipmap_level member.

	* backends/gl/GlTextures.cpp (shGlFormat): Replace a comment by an
	assertion.
	(bindTexture): Create extra GLStorage for the mipmap levels if it
	is enabled.

	* backends/gl/GlTextureName.cpp (params): Turn on mipmapping if it
	is set in the traits.

	* src/ShTextureNode.hpp: Add m_mipmap_levels and m_nb_memories.
	Add the mipmap_level parameter to the memory() methods.
	Remove SH_FILTER_MIPMAP and replace it with
	SH_FILTER_MIPMAP_NEAREST and SH_FILTER_MIPMAP_LINEAR.
	Add the mipmap_levels() and build_mipmaps() public methods.
	
	* src/ShTextureNode.cpp: Add interpolation methods to generate
	mipmaps automatically.
	Reinitialize the memories when the texture size is changed.
	Add the mipmap_level parameter to the memory() methods.
	Add the mipmap_levels() and build_mipmaps() public methods.

	* src/ShTexture.hpp: Make the default mipmap filtering be linear.

	* src/ShBaseTextureImpl.hpp, ShBaseTexture.hpp: Add the
	mipmap_level parameter to all memory() methods.
	Add the build_mipmaps() public method.
	
	* src/ShMIPFilter.hpp: New file containing the ShNoMIPFilter and
	ShMIPFilter templates.

	* src/sh.hpp: Include ShMIPFilter.hpp
	
	* backends/cc/Cc.cpp, backends/gl/Utils.cpp, PBufferStreams.cpp:
	Add the mipmap_level to the memory() calls.
	
	* win32/Sh.vcproj, src/Makefile.am, src/Makefile.win32: Add
	ShMIPFilter.hpp to the project and makefiles.

	* test/regress/tex.cpp.py: Make all the textures be non-mipmapped
	for now.

	* configure.ac, examples/Makefile.am, examples/mipmap/*: Add the
	mipmap example to test that mipmap is working correctly.

	* examples/textures/*: Turn on mipmapping in the diffuse textures
	and off in the specular textures.  One texture, default, will
	provide all the images for the mipmap levels while the other one,
	rust, will let Sh generate them.

2005-07-05  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShRefCount.hpp (class ShPointer): Use Boost's
	unspecified_bool_type trick to allow implicit conversion to bool
	but nothing else.

2005-06-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/cc/Cc.cpp (load_shader_func): Use -bundle on OSX
	instead of -shared. Fixes issue196.

	* backends/gl/ArbBackend.cpp (shBackend_libsharb_target_cost):
	Indicate that we cannot run stream programs on OSX yet.

	* backends/gl/GlslBackend.cpp (shBackend_libshglsl_target_cost):
	Indicate that we cannot run stream programs on OSX yet.

	* examples/particle/Camera.cpp: Copy from glut example for OSX fixes.

	* examples/particle/main.cpp (gprintf): Use GLint instead of int
	for viewport variable.
	Correct headers for OSX.

	* examples/particles/Makefile.am (LDADD): Use GLUT_LIBS and
	GL_LIBS for cross-platform compilation (osx in particular).

2005-06-22  Francois Marier  <francois@serioushack.com>

	* backends/cc/Cc.cpp (load_shader_func): Remove the -shared
	parameter on OSX (patch from evan AT dogboy DOT org).

2005-06-21  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.hpp, GlslEmit.cpp (emit_comment): Add this
	method.

	* backends/gl/GlslEmit.cpp (emit): Add support for the
	SH_OP_COMMENT operation.

	* backends/cc/Cc.cpp, Cc.hpp (delete_temporary_files): Add this
	method to delete the temporary files created before execution.
	(execute): Call delete_temporary_files() once execution is done.
	(generate): Move the library loading code to load_shader_func.
	(load_shader_func): Add this method.
	
	* src/ShMemory.hpp, ShMemory.cpp (dirtyall): Use
	increment_timestamp to update the memory timestamp and to
	correctly handle out-of-sync objects.
	(increment_timestamp): Add this method to replace updateTimestamp.
	(updateTimestamp): Remove this method.
	
	* src/ShLibMatrixImpl.hpp, ShLibMatrix.hpp (operator|): Expand
	matrices if their sizes are not compatible.
	(operator*): Allow matrices of incompatible sizes

	* src/ShLibGeometryImpl.hpp, ShLibGeometry.hpp (dot): Allow
	vectors of different sizes and return an ShException in that case.
	This is necessary for the matrix expansion changes.

	* src/test/regress/common.py: Add a matrix_expansion function.

	* src/ShMatrix.hpp, ShMatrixImpl.hpp: Remove unused copy
	constructor.

	* src/ShMemory.cpp, ShMemory.hpp (value_type): When changing the
	value type, also update the size.

2005-06-17  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbEmit.cpp (emit_eq): Fix emit_eq so that it works
	when emitting SNE.  This will fix the issue of SNE not working on
	ATI.

	* src/ShImage.hpp (load_PNG): Add this function with a deprecated
	comment because it is mentionned in one of the examples of the
	book.

2005-06-16  Francois Marier  <francois@serioushack.com>
	
	After the 0.7.8 release:

	* backends/gl/Glsl.hpp, Glsl.cpp: Rename unbind_all() to
	unbind_all_programs().

2005-06-15  Francois Marier  <francois@serioushack.com>

	* util/shutil.cpp, shutil.hpp: Add the normalize_path() function
	to convert the path separators in the pathname to "\" on Windows
	and to "/" on UNIX.

2005-06-14  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslEmit.cpp (emit_cond): Make cond() follow the
	Glsl spec except on NVIDIA where component-wise COND is available.

2005-06-13  Francois Marier  <francois@serioushack.com>
	
	* src/ShMemory.hpp: Remove the default value of "value_type" in
	the ShHostMemory constructors.

	* examples/particle/main.cpp: Must specify the value_type when
	creating ShHostMemory objects.

	* backends/gl/ArbEmit.cpp, ArbCode.hpp (real_div): Add this method.

	* backends/gl/ArbEmit.cpp (emit_div): Make use of real_div().
	(emit_hyperbolic): Make use of real_div().
	Remove useless instructions in COSH and SINH.

	* backends/gl/GlslEmit.cpp (emit_discard): Properly cast the zero
	constant.

2005-06-10  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslEmit.cpp, GlslCode.hpp (emit_cond): Add this
	method to properly typecast the 0 constant.

2005-06-09  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbCode.cpp, ArbReg.cpp, ArbReg.hpp: Add support for
	the extra color ouputs of the ATI_draw_buffers extension.

2005-06-08  Francois Marier  <francois@serioushack.com>

	* src/ShContext.cpp, ShContext.hpp (set_binding): There's no
	reason why the ShProgram argument shouldn't be a constant
	reference.

	* src/ShProgramNode.cpp, ShProgramNode.hpp, ShProgram.hpp
	(is_compiled): Add this method (issue35).

	* src/ShBackend.cpp, ShBackend.hpp (derived_targets): Add this
	method to reduce coupling between the available backends and the
	methods that take a "target" argument.

	* src/ShContext.cpp (bound_program): Make use of the new
	derived_backends() method in ShBackend.

2005-06-07  Francois Marier  <francois@serioushack.com>

	* backends/gl/PBufferStreams.cpp (execute): Only use an
	intermediate stream if there are channels that are both being read
	from and written to.  That way if users are already
	double-buffering, no intermediate stream will be used (issue152).

2005-06-06  Francois Marier  <francois@serioushack.com>

	Removing ShUnclamped and adding types to ShStorage:
	
	* src/ShMemory.cpp, ShMemory.hpp: 
	Add a value type to ShStorage.
	Add an extra parameter to the ShHostStorage and ShHostMemory
	constructors (defaults to SH_FLOAT in the case of ShHostMemory).
	Do type conversion on host-to-host transfers.
	Add value_type() and value_size() methods to ShStorage.

	* src/sh.hpp, Makefile.am, Makefile.win32, win32/Sh.vcproj:
	Remove ShClamping.h

	* src/ShTable.hpp, ShTexture.hpp, ShTextureNode.hpp, ShArray.hpp:
	Remove the clamping trait.

	* src/ShImage.cpp, ShImage3D.cpp: Explicitely specify that the
	host memory type should be SH_FLOAT.

	* backends/cc/CcTexturesString.hpp, CcTextures.hpp, CcEmit.cpp:
	Remove all clamping-related code and comments.

	* backends/cc/Cc.cpp: Specify the host memory type when
	constructing the host storage.

	* backends/gl/PBufferContext.cpp: Remove unused constructor.  
	Add assert to make sure the type of both storage objects match in
	the transfer method.

	* backends/gl/PBufferContext.hpp: Remove unused constructor and
	make_storage method.

	* backends/gl/Utils.cpp, GlTextureName.cpp: Remove the clamping
	trait.
	
	* backends/gl/PBufferStreams.cpp: Specify the value type when
	creating storage and memory objects.
	Add assert to ensure proper types.

	* backends/gl/GlTextures.cpp: Remove all clamped code and leave
	only the unclamped alternative.

	* backends/gl/GlTextureStorage.cpp, GlTextureStorage.hpp: Remove
	the m_valueType member and the valueType() method since they have
	been moved to ShStorage.
	Do type conversion on host-to-GL transfers.

	* test/regress/shtest.py, test.hpp, tex.cpp.py: Specify the value
	type when creating the host memory.

	* test/regress/tex.cpp.py: Remove all ShUnclamped and ShClamped.

	* examples/textures/main.cpp: Change textures from AttribNf to
	AttribNfub.
	
2005-06-06  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* test/regress/test.hpp:
	Fixed ShVariant constructors to match changes made below.

	* backend/gl/GLTextureStorage.cpp, backends/gl/PBufferStreams.cpp:
	Fixed ShVariant constructors to match changes made below.

	* src/ShGenericImpl.hpp:
	Fixed ShVariant constructors to match changes made below.

	* src/ShVariant.hpp, src/ShVariantImpl.hpp, src/ShVariantFactory.hpp,
	src/ShVariantFactoryImpl.hpp: Modified ShDataVariant constructor 
	arguments to be consistent with other constructors. Associated
	generate() functions were also modified for consistency.

2005-06-06  Francois Marier  <francois@serioushack.com>

	* backends/gl/Glsl.cpp, GlslSet.cpp, GlslCode.cpp, ArbLimits.hpp,
	ArbCode.hpp, ArbCode.cpp:  Change some ints to GLints to fix
	compilation errors on OSX (issue195).

2005-05-31  Francois Marier  <francois@serioushack.com>

	* src/ShContext.cpp, ShContext.hpp (bound_program): Add this method.
	(is_bound): Add this method.
	(shIsBound): Add this function.
	(shBound): Add this function.

2005-05-31  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* src/Makefile.win32: Updated to reflect previous changes to VS project
	files.
	
	* src/ShHalfImpl.hpp: Changed fabsf to fabs, code uses doubles.

2005-05-30  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* test/regress/Makefile.am (INCLUDES): Use $(top_srcdir) to allow
	out-of-source build.
	(AM_LDFLAGS): Use $(top_builddir) to allow out-of-source build.

2005-05-30  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslVariable.cpp (GlslVariable): Typecast all
	numerical constants.
	
	* backends/gl/Makefile.am: Moving the common GL stuff into a
	separate library.

	* src/ShBackend.cpp: Ignore the libshgl library since it is not a
	real backend.
	
	* backends/gl/GlTextureStorage.cpp (HostGlTextureTransfer):
	Restoring the dynamic_cast.

	* src/ShBackend.cpp, ShBackend.hpp (is_valid_name): Add this
	method.
	(load_library): Check whether the backend name is valid before
	trying to load the library (issue194).

	* src/ShVariableType.hpp, ShVariableType.cpp: Add the SH_PLANE
	semantic type.

	* src/scripts/ShPlane.hpp.py, src/ShPlane.hpp, ShLibPlane.hpp: Add
	these files for the new SH_PLANE semantic type.
	
	* src/ShSyntax.cpp, ShSyntax.hpp (shHaveBackend): Add this
	function (issue34).
	(shClearBackends): Add this function (issue33).
	(shFindBackend): Add this function (issue34).

	* src/ShBackend.cpp, ShBackend.hpp (have_backend): Add this
	method.
	(target_handler): Add this method and make get_backend() use it.

2005-05-26  Francois Marier  <francois@serioushack.com>

	* src/ShBackend.cpp: Refactor the code related to the library
	loading and search paths.
	Add a user path for user-installed libraries on UNIX.
	(~ShBackend): Unload the library whenever the backend is
	destroyed.

	* src/ShBackend.hpp (load_libraries): Add this method.

2005-05-25  Francois Marier  <francois@serioushack.com>

	Backend infrastructure improvements (issue31):
	
	* src/ShBackend.cpp (target_cost): Separate library loading,
	backend instantiation and cost function.  A backend is no longer
	initialized unless it is the best backend that should be used.

	* backends/cc/Cc.cpp, Cc.hpp, backends/gl/ArbBackend.cpp,
	GlslBackend.cpp: Remove the can_handle() method to replace it with
	the target_cost() non-member function.
	
	* src/ShBackend.hpp, ShBackend.cpp: Add an unbind_all_backends()
	static method that iterates through all backends and calls
	"unbind_all_programs()" on them.

	* backends/gl/GlBackend.cpp, GlBackend.hpp: Rename the
	unbind_all() methods to unbind_all_programs() in order to
	differentiate them from ShBackend::unbind_all_backends().	
	Remove the can_handle() method.

	* src/ShSyntax.cpp (shUnbind): No need to iterate through all
	backends, this is done from within ShBackend now.


2005-05-20  Francois Marier  <francois@serioushack.com>

	Backend infrastructure improvements (issue31):

	* backends/cc/Cc.cpp, Cc.hpp, ArbBackend.cpp, GlslBackend.cpp:
	Make the can_handle() method return an integer cost instead of a
	boolean value.

	* backends/gl/GlBackend.cpp, GlBackend.hpp (can_handle): Return an
	integer cost instead of a boolean. Only provide the costs that are
	common to both Arb and Glsl.

	* src/ShBackend.cpp, ShBackend.hpp: Remove the generic
	can_handle() function since it is not used by the other backends
	anymore.  Make the pure virtual can_handle() method return an int.
	
	* src/ShBackend.cpp, ShBackend.hpp: Add lists of selected and
	instantiated backends.
	Add get_backend(), can_handle(), use_backend(), clear_backends()
	and load_library().
	Remove all references to ShEnvironment.  

	* src/ShSyntax.cpp: Convert all calls to ShEnvironment::backend to
	calls to ShBackend::get_backend().
	Remove the ShEnvironment include.
	Add an shUseBackend() method.

	* src/ShSyntax.hpp: Add an shUseBackend() method.

	* src/ShStream.cpp (operator=): Convert call to
	ShEnvironment::backend to ShBackend::get_backend(). 

	* backends/gl/ArbCode.cpp, src/scripts/ShAttribImpl.hpp.py,
	src/ShAttribImpl.hpp, ShProgramNode.cpp, ShTextureNode.cpp,
	ShFixedManipulator.cpp, ShAlgebra.cpp, ShVariableNode.cpp: 
	Remove the ShEnvironment include.

	* backends/gl/GlBackend.cpp, GlBackend.hpp (can_handle): Add this
	method.
	
	* backends/gl/ArbBackend.cpp, GlslBackend.cpp: Remove the static
	variable and instead add a non-member function to initialize the
	backend.
	(version): Add this method.

	* backends/gl/PBufferStreams.cpp (execute): Removed the target
	check since by that time it should have already been done.

	* backends/gl/GlTextureStorage.cpp (HostGlTextureTransfer):
	Changed a dynamic_cast to a static_cast as a hack to support two
	copies of this class to be loaded at the same time.

	* test/regress/shtest.py: Set the backend to "stream" instead of
	"gpu:stream" since we want to test the "cc" backend as well.

	* examples/particle/main.cpp, glut/main.cpp, textures/main.cpp:
	Instead of always calling shSetBackend, only call shUseBackend
	when a backend name has been specified on the command line.

2005-05-16  Francois Marier  <francois@serioushack.com>

	* src/ShLibMiscImpl.hpp (poly): Improve efficiency of the
	algorithm used to compute poly().

2005-05-10  Francois Marier  <francois@serioushack.com>

	Improve the speed of row by row matrix assignment (mat_asn_vec).

	* src/scripts/ShAttribImpl.hpp.py (Impl.scalarcons): Set all
	values at once using setValues() instead of several calls to
	setValue().
	
	* src/ShVariantImpl.hpp: Inline all the variant_cast() functions.

	* src/ShGenericImpl.hpp (setValues): Replace the std::copy call by
	a for loop.

2005-05-09  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslEmit.cpp (emit_texture): Fix the swizzle for
	2-component texture lookups.

2005-05-09  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* configure.ac: On OS X, add -lSystem instead of -lmx. This seems
	to be more appropriate, and allows linking with libraries such as
	wxwidgets without causing duplicate symbols.

2005-05-06  Francois Marier  <francois@serioushack.com>

	* backends/gl/PBufferStreams.cpp (execute): Allocate a bigger
	texture for 2-component outputs.

	* src/ShLibMiscImpl.hpp (poly): Remove unnecessary invocations of
	the pow() function.

2005-05-05  Francois Marier  <francois@serioushack.com>

	* src/ShLibMiscImpl.hpp, ShLibMisc.hpp (poly): Add the poly()
	library function.

	* src/ShVariableNode.cpp (delete): Only free the pointer from the
	pool if the memory pool was actualy being used.  This fixes a
	problem reported on libsh-devel by Jamie Burns.

2005-05-04  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbCode.cpp (printVar): Scalar variables which were
	not assigned a register should just be inserted as immediate
	values.

	* backends/gl/GlslVariableMap.cpp (real_resolve): Remove
	unnecessary parentheses around negated variables.

	* backends/gl/GlslVariable.cpp (GlslVariable): Don't assign a glsl
	variable to scalar constants.  Insert them in the code directly.

	* backends/gl/GlslCode.cpp (real_update_uniform): Display more
	information in the debugging message (size and kind).

2005-05-02  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslVariableMap.cpp (allocate_builtin_inputs):
	Display an error if an input was left unassigned. 

	* backends/gl/GlslVariableMap.cpp (allocate_builtin_outputs):
	Display an error if an output was left unassigned. 

	* backends/gl/GlslEmit.cpp (table_substitution): Don't cast
	variables twice in the case of assignment operations.

	* backends/gl/GlslCode.cpp (real_update_uniform): Output more
	information about the unknown uniform in the debug message.

2005-04-28  Francois Marier  <francois@serioushack.com>

	* backends/gl/PBufferStreams.cpp (execute): Add support for
	two-component output by using a GL_RGB buffer and discarding the
	third component after the copy.

	* src/ShVariant.hpp, ShVariantImpl: Add a count parameter to the
	ShDataVariant copy constructor to fix the problem where only the
	first element was being copied.

2005-04-26  Francois Marier  <francois@serioushack.com>

	* src/ShOperation.hpp, ShOperation.cpp, ShInstructions.hpp,
	ShInstructions.cpp, ShLibTrig.hpp, ShLibTrigImpl.hpp, ShLib.hpp,
	ShEvalImpl.hpp: Add the COSH, SINH and TANH IR operations.

	* src/ShConcreteCTypeOp.cpp, ShConcreteRegularOpImpl.hpp:
	Implementation of the hyperbolic trig functions in immediate mode.
	
	* backends/gl/ArbEmit.cpp, ArbCode.hpp, GlslEmit.cpp,
	GlslCode.hpp: Add approximations for the COSH, SINH and TANH
	operations.

	* backends/cc/CcEmit.cpp: Use the standard C functions to
	implement COSH, SINH and TANH.

2005-04-25  Francois Marier  <francois@serioushack.com>

	* util/ShFunc.hpp, ShFuncImpl.hpp: Rename "smoothstep" to
	"deprecated_smoothstep" since it is a cubic function whereas the
	book defines is as a linear function.

	Move the bezier function implementation here from Shrike's
	utilimpl.hpp. It should be moved to the core later.

	* src/ShLibClamp.hpp, ShLibClampImpl.hpp: Add the smoothstep() and
	smoothpulse() functions from Shrike's utilimpl.hpp (issue63).

2005-04-20  Francois Marier  <francois@serioushack.com>

	* src/, src/scripts/, util/: Make semantic types template
	parametrization of ShAttrib.  The semantic type is now an extra
	template parameter before swizzle.

	This means however that it is no longer possible to have types
	like ShColor<3, SH_TEMP, float>, but the typedefs such as
	ShColor3f are still available from within ShColor.hpp.

2005-04-08  Francois Marier  <francois@serioushack.com>

	* src/scripts/semantic.py: Add operator++() and operator--()

	* src/ShGenericImpl.hpp, ShGeneric.hpp (operator++): Add this
	method.

	* src/ShGenericImpl.hpp, ShGeneric.hpp (operator--): Add this
	method.

	* backends/gl/GlslEmit.cpp (emit_logic): Removed the notEqual()
	work-around on NVIDIA since the bug has been fixed.

	* src/ShConcreteRegularOpImpl.hpp, ShConcreteCTypeOpImpl.hpp: 
	Fix implementation of prod in immediate mode.

2005-04-08  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.hpp, backends/gl/ArbCode.cpp,
	backends/gl/ArbEmit.cpp: Implement RET for NVFP2. There are still
	some interactions with input/output transformers that won't work
	right, e.g. if you read from an output variable RET won't do the
	right thing.

	* backends/gl/ArbInst.hpp, backends/gl/ArbInst.cpp: Added
	RET instruction.

	* src/ShInstructions.hpp, src/ShInstructions.cpp: Added
	shRET() instruction call.
	  
	* src/ShOperation.hpp, src/ShOperation.cpp: Added SH_OP_RET.

2005-04-07  Francois Marier  <francois@serioushack.com>

	* backends/cc/CcEmit.cpp, backends/gl/ArbEmit.cpp (emit_mod),
	src/ShConcreteCTypeOp.cpp, src/ShConcreteCTypeOpImpl.hpp: Fix the
	mod function so that it matches the glsl one and produces a nice
	sawtooth function.

2005-04-07  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/cc/Makefile.am (libshcc_la_LIBADD): Fix building out of
	tree for CC backend.

	* Merged OSX trunk.

2005-04-07  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> osx branch

	* Merged trunk up to r2275. Hopefully for the last time.

2005-04-06  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslEmit.cpp (emit_log): Removed the static constant
	to fix a bug when using both log and log10 in the same program.

2005-04-05  Francois Marier  <francois@serioushack.com>

	* src/ShLibMatrixImpl.hpp (trace): Add this function.

2005-04-04  Francois Marier  <francois@serioushack.com>

	* src/ShMatrix.hpp, ShMatrixImpl.hpp (operator-): Add this method.
	(operator*=): Add this method.

2005-03-29  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> osx branch

	* util/: Fix this directory from being a strange mix of old and
	new revisions to be the same as trunk at r2203.

2005-03-28  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> osx branch

	* config/gl.m4 (GL_CHECK_GL_HEADERS): We don't need -framework
	AGL. Remove it.

2005-03-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> osx branch

	* README.osx: Continue to increase the accuracy of this document.

	* configure.ac: Replace CPPFLAGS, not CXXFLAGS. Removes a warning
	on Darwin.

	* Allow out-of-source tree building, by changing various
	Makefile.ams appropriately.

	* src/ShSwizzleImpl.hpp (idswiz): Replace an "ifdef __MAC__" with
	"ifdef __APPLE__"

2005-03-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShAttrib.cpp, src/ShVector.cpp, ...: Remove explicit
	instantiation files and the python scripts in scripts/ that
	generated them (they haven't been used for a long time).

2005-03-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> osx branch

	* win32/Sh.vcproj: Added another missing file.

	* backends/gl/GlslEmit.cpp (emit_discard): Remove an incorrect
	comment.

	* src/ShLibClampImpl.hpp: Uncommented some commented out code.

	* win32/Sh.sln: Added this missing file from the trunk.

	* examples/glut/Makefile.am (LDADD): Use GLUT_LIBS and GL_LIBS.

	* examples/glut/main.cpp: Make this compile on Apple.

	* backends/gl/Makefile.am: No pbuffer streams on Apple... 

	* backends/gl/ArbBackend.cpp: No pbuffer streams on Apple.

	* configure.ac: Check for ARB_shading_language_100 for GLSL
	support.
	Disable PBuffer streams on darwin.

	* config/gl.m4: Substitute GL_LIBS and GLUT_LIBS.
	(GL_CHECK_GLEXT_EXTENSION): Added this function.

	* examples/binding/Makefile.am (LDADD): Use GLUT_LIBS, GL_LIBS.

	* examples/binding/main.cpp (main): Catch exceptions.
	Handle Apple headers.

	* Merge trunk up to r2189.

	* backends/gl/GlTextures.cpp: Implement APPLE_float_pixels
	support.

	* README.osx: Update this a little.

2005-03-25  Francois Marier  <francois@serioushack.com>

	* src/ShLibClampImpl.hpp: Add scalar version of mod.

	* src/ShLibArithImpl.hpp: Add scalar version of pow.

	* src/ShInstructions.cpp: Enable scalar versions of mod and pow.
	
	* backends/gl/GlslEmit.cpp: Fixed cond so that it behaves
	according to the book when a < 0.

2005-03-23  Francois Marier  <francois@serioushack.com>

	* src/ShLibMiscImpl.hpp, ShLibMisc.hpp (sort, groupsort): Add
	these functions based on util/ShFunc.hpp

2005-03-21  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/GlslEmit.cpp (emit_discard): Fix discard.

2005-03-18  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslVariable.cpp (GlslVariable): Use the contents of
	meta("opengl:state") to initialize m_name and m_builtin.

	* backends/gl/GlslVariable.hpp: Add a builtin() method.

	* backends/gl/GlslVariableMap.cpp (allocate_temp): Add a check to
	avoid double insertions in the map.
	Don't set the name for built-in variables.
	Use the new builtin() method to determine whether or not a
	variable is built-in.

	* backends/gl/GlslVariableMap.hpp, GlslVariableMap.cpp: Remove
	allocate_palette() since it's the same as allocate_temp().

	* backends/gl/GlslVariableMap.cpp (GlslVariableMap): Use
	allocate_temp() instead of allocate_palette().
	
	* backends/gl/GlslCode.cpp (updateUniform): Remove warning about
	unknown uniform.  This caused unnecessary output in the examples.

	* examples/binding/main.cpp: Remove debugging output.
	Remove unnecessary glDisable() calls in gprintf().

2005-03-17  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslVariableMap.cpp, GlslVariableMap.hpp,
	GlslVariable.cpp, GlslVariable.hpp, GlslEmit.cpp, GlslCode.cpp,
	GlslCode.hpp: Add support for the PAL operation and initialize the
	palette uniforms properly.
	
2005-03-16  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.hpp, GlslEmit.cpp (allocate_constant): Add
	this function and make use of it in operations that depend on a
	constant (cbrt, exp and log).  Instead of using a temporary
	variable, these operations now use a constant that's initialized
	beforehand.

	* backends/gl/GlslEmit.cpp (table_substitution): Make use of
	glsl_typename().

	(emit_logic): Remove unnecessary parantheses. Make use of
	glsl_typename().

	(emit_cbrt): Add this function to handle the CBRT operation
	separately and properly initialize the 1/3 constant.

	(allocate_temp): Set the binding to SH_TEMP, not the same as
	stmt.dest necessarily.

	(resolve_constant): Output the constants in the glsl code using
	the maximum precision.

	(emit_lit): All constants should be of size 1 since each component
	of the output is computed separately.

	* backends/gl/GlslCode.cpp: Added a debug #define to
	always display the glsl shader source code.

2005-03-15  Francois Marier  <francois@serioushack.com>

	Fixes for ATI support in the glsl backend.
	
	* backends/gl/GlslVariableMap.cpp: Repeat scalars instead of
	swizzling them. 

	* backends/gl/GlslEmit.cpp, GlslCode.hpp: Cast all literals
	properly through a new resolve_constant() method.

	* backends/gl/GlslEmit.cpp: Remove superfluous operation and
	constant in prod and sum.  Remove the "f" from float literals.

	* backends/gl/GlslVariableMap.cpp, GlslVariableMap.hpp (resolve):
	The swizzle to access the first component is unnecessary when the
	variable is a scalar.

	* backends/gl/Glsl.cpp, Glsl.hpp (glsl_typename): Add this
	function.

	* backends/gl/GlslVariable.cpp (type_string): Make use of
	glsl_typename.
	
2005-03-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/GlslEmit.cpp (emit_texture): Swizzle texture lookups
	to the expected size. Fixes many GLSL backend problems on ATI (but
	not all of them, in particular implicit bool->float casts).
	(table_substitution): Just cast everything statically.
	(emit_logic): Add bool->float casts.

	* win32/ShArbBackend.vcproj, win32/ShGlslBackend.vcproj: Include
	Utils.cpp and Utils.hpp

	* backends/gl/Makefile.win32 (PBUFFERSTREAM_SOURCES): Include
	Utils.*.

	* backends/gl/Makefile.am (PBUFFERSTREAM_SOURCES): Include
	Utils.[ch]pp.

	* backends/gl/Utils.cpp (split_program): Add this function.

	The "Make Arno and Nils Happy" patch.
	
	* backends/gl/PBufferStreams.cpp: PBufferStreams caches its
	fragment programs now. Hooray, particle system demo is about 100
	times faster....

	* src/ShProgramSet.hpp (ShProgramSet): Make ShProgramSets
	reference-countable. Happy Pi day.

2005-03-14  Francois Marier  <francois@serioushack.com>

	* backends/gl/GlslCode.cpp, GlslCode.hpp: Support for control flow
	constructs.
		
	* backends/gl/GlslEmit.cpp: Cast variables to bool when they are
	used in a conditional or loop statement.

2005-03-09  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbEmit.cpp (emit_ceil): Allocate a temporary
	variable to prevent reading from stmt.dest.

	* backends/gl/ArbEmit.cpp (emit_cmul): Added a missing parameter
	to the MUL operation.

	* backends/gl/ArbEmit.cpp, backends/gl/ArbCode.hpp: Added the CBRT
	and RND operations.
	
2005-03-09  Bryan Chan <b8chan@cgl.uwaterloo.ca>
	
	* src/ShTypeInfo.hpp, ShTypeInfo.cpp (m_valueTypes):
	Changed to pointer to avoid static initialization snafus. 

2005-03-04  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* configure.ac: Bump glext.h version to 21 for the GLSL backend.

	Merged glsl branch into trunk.

2005-03-04  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> (glsl branch)

	* backends/gl/GlslEmit.cpp (emit_discard): Fix KIL implementation
	(KIL doesn't return anything).

	* src/ShSyntax.cpp (shUnbind): Use ShBackend::unbind_all().

	* backends/gl/GlBackend.hpp: Add unbind_all() to CodeStrategy.

	* backends/gl/Glsl.hpp: Add unbind_all().

	* backends/gl/Glsl.cpp (unbind_all): Implement glsl-specific
	unbind_all() using GlslSet.

	* src/ShBackend.cpp (unbind_all): Default implementation.

	* src/ShBackend.hpp: Added unbind_all() functions

	* backends/gl/GlslCode.hpp: Remove the optimize() function.

	* backends/gl/GlslCode.cpp (unbind): Keep around the old
	GlslSet::current() (it can become null if it already was
	m_fallback_set). This fixes a segfault related to binding.

	* src/ShSyntax.cpp (shUnbind): Implement shUnbind().

	* src/ShSyntax.hpp: Add parameterless shUnbind() prototype.

	* backends/gl/PBufferStreams.cpp (execute): Unbind our shaders.

	* backends/gl/GlslSet.cpp (GlslSet copy constructor): Use attach()
	to attach shaders.
	(GlslSet::operator=): Call detach and attach.

2005-03-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> (glsl branch)

	* examples/glut/main.cpp: Use a ShProgramSet to contain the shaders.

	* backends/cc/Cc.cpp (ShCc): Rename generateCode() to
	generate_code().

	* backends/cc/Cc.hpp (ShBackend): Rename generateCode() to
	generate_code().

	* backends/gl/GlslCode.cpp: Implemented GlslSet functionality, and
	use GlslSet functionality appropriately from GlslCode.

	* backends/gl/GlslCode.hpp (GlslSet): Added this class.
	(GlslCode): Simplified a fair bit, moving a lot to GlslSet.

	* backends/gl/Glsl.hpp: More ProgramSet changes.

	* backends/gl/GlBackend.hpp (CodeStrategy): Added ShProgramSet
	support.
	(GlBackend): Rename generateCode() to generate_code().

	* win32/Sh.vcproj: Added ShProgramSet files.

	* src/Makefile.win32 (libsh_dll_SOURCES): Added ShProgramSet
	files.

	* src/Makefile.am (libsh_la_SOURCES): Add ShProgramSet files
	(incinc_HEADERS): Add ShProgramSet.hpp header.

	* src/sh.hpp: Include ShProgramSet.hpp.

	* src/ShBackend.hpp, src/ShBackend.cpp: Added backend program set
	mechanism.

	* src/ShSyntax.hpp, src/ShSyntax.cpp: Added functions to
	bind/link/unbind program sets.

	* src/ShProgramSet.hpp, src/ShProgramSet.cpp: Added program sets.

2005-03-02  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	* backends/gl/ArbCode.cpp (ArbCode::print): Fixed NVFP register
	decls to use "SHORT TEMP" and "LONG TEMP"

2005-03-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca> (glsl branch)

	* src/ShBackend.hpp: Rename generateCode() to generate_code().

	* examples/glut/main.cpp (main): Use arb backend by default, allow
	passing in a backend name.
	(display): Add back in the gprintfs.
	
2005-03-01  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* util/ShObjMesh.cpp (ShTriple::ShTriple): Be a little less
	aggressive about unexpected characters, and in particular restore
	skipws.

2005-02-25  Francois Marier  <francois@serioushack.com>

	* sh/trunk/backends/cc/Cc.cpp, Cc.hpp, 
	sh/trunk/backends/gl/ArbCode.cpp, ArbCode.hpp, 
	sh/trunk/src/ShBackend.hpp: Added the unbind() method.

	* sh/trunk/src/ShSyntax.cpp, ShSyntax.hpp: Added the shUnbind
	function to unbind a previously bound shader (does nothing if the
	shader was not already bound).

	* sh/trunk/backends/gl/ArbCode.cpp,
	sh/trunk/backends/gl/PBufferStreams.cpp: Move the
	glEnable(GL_*_PROGRAM_ARB) and glDisable calls to the bind() and
	unbind() methods of ArbCode.

	* sh/examples/*: Remove the glEnable(GL_*_PROGRAM_ARB) calls.
	Replace the glDisable(GL_*_PROGRAM_ARB) calls with shUnbind().
	
2005-02-23  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/Makefile.win32 (libsharb_dll_SOURCES): Update for
	the new PBufferContext classes. Sorry for forgetting these.

2005-02-22  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl: Folded in some changes from the cflow branch. In
	particular, improved PBuffer context handling.

	* src/ShConstProp.cpp (operator<<(ostream&, ConstProp::Cell)):
	Output the encoded value instead of the value pointer. Doh.
	(ConstProp::updateDest): Don't mark entirely constant expressions
	as uniform. Fixes issue159.
	(struct FinishConstProp): Break out based on uniform < 0 first, so
	that we get less confusing debugging messages.

	* src/ShInfoImpl.hpp (destroy_info): Actually delete the items we
	wish to destroy. Should fix some memory leaks...

	* src/ShBitSet.cpp (operator=): Handle self-assignment correctly.

2005-02-18  Kevin Moule  <krmoule@cgl.uwaterloo.ca>
	
	* backends/gl/ArbCode.cpp: Added support for "opengl:texunit" and
	"opengl:preset" on ShTextures and "opengl:reservetex" on ShPrograms.
	
	* backends/gl/ArbReg.cpp, backends/gl/ArbReg.hpp: Added preset
	flag to ArbReg for textures with reserved units.
	
	* backends/gl/GlTextures.cpp: Removed "opengl:preset" processing,
	this is now done in ArbCode.cpp. Renamed "opengl:texid" to
	"opengl:alloc_texid".
	
2005-02-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShLibMatrixImpl.hpp (rotate): Fix rotations.

2005-02-11  Bryan Chan  <b8chan@cgl.uwaterloo.ca>

	* src/ShInstructions.hpp, ShInstructions.cpp, src/ShVariable.hpp,
	ShVariable.cpp: Backed out some const changes that don't make
	sense.

	Merged in some fixes from arithmetic:
	
	*  src/ShSection.hpp, ShSectionImpl.hpp (realDump):
	Graphviz dump should work now (no more cfg nodes in wrong places).

	* backends/gl/GlTextures.cpp (shGlInternalFormat):
	Changed to use ATI's extensions on NV cards when the tex dims are non-RECT
	(NV's recent drivers only support 1/2/3D float textures through
	ATI_texture_float)

2005-02-10  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/scripts/ShAttribImpl.hpp.py (Impl.scalarcons): Only do
	constant-assignment when the types being passed are host_type.

	* src/ShBaseTexture.hpp: Made width(), height() and depth()
	constant for all the ShBaseTexture classes.

2005-02-09  Francois Marier  <francois@serioushack.com>

	* src/scripts/ShAttribImpl.hpp.py (Impl.scalarcons):
	Constant assignment now done as a single statement (issue44).

2005-02-09  Bryan Chan	<b8chan@cgl.uwaterloo.ca>
	Removed range arithmetics from trunk.  They were only partially working,
	and the implementation in arithmetic branch is quite different now. 

	This will be merged back in later when it's clean, and some usability problems
	have been solved (e.g. IA/AA types in textures/streams), that I don't want to deal 
	with yet. 

	Merged several new features and fixes from arithmetic.

	A) Using ShProgram as a function in other ShPrograms
		* src/ShRecord.hpp ShRecord.cpp:
		Morphed ShStream into something similar for ShVariable.	
		Implements operators like (a & b) = p(c & d & e) for
		execution in immed mode, insertion into parse in retained mode.
		(immed mode eval todo - should be just one or two lines)

		* src/ShVariable.hpp ShVariable.cpp (operator=(ShProgram)):
		Changed original operator= for dep uniforms to attach(ShProgram).
		New operator= works as program execution/insertion like above for ShRecord.

		* src/ShCfgBlock.hpp:
		A ShBlock subclass that represents inserting a previously defined 
		single-entry/single-exit control graph into the current parse. 

		* src/ShProgram.hpp ShProgram.cpp (operator()):
		Added p(some_args) operators.

		* src/ShProgramNode.hpp, ShProgramNode.cpp (collectDecl, collectVariables,
																							hasDecl, addDecl)
			ShOperation.hpp, ShOperation.cpp (SH_OP_DECL),
			ShCtrlGraph.hpp, ShCtrlGraph.cpp (addDecl, hasDecl, decl_begin, decl_end),
			ShParser.hpp, ShParser.cpp (parseSection),
			ShConstProp.cpp (ShConstProp::ShConstProp),
			ShOptimizations.cpp (optimize, InitLiveCode::operator()),
			ShVariableNode (programDeclInit):
		Added a dummy op SH_OP_DECL to indicate declaration points of temps,
		Changed ShParser to collect SH_OP_DECL into cfg nodes during parse,
		Changed optimizations to deal with decls 
			-live code init, constprop - treats non-decl'd temps like INOUTs
				-assignments are live, initial uses have unknown value
			-straightener also merges decl sets when coallescing a block 
		Added decls to CtrlGraphNode dumps.
		Made variable nodes insert decls into the parse when appropriate.

		* src/ShAlgebra.hpp, ShAlgebra.cpp (replaceUniform -> replaceVariable):
		Made replace substitue any kind of variable for an input instead of just
		uniforms. 

	B) User-defined section blocks (DOT dumps are flaky, so for internal use right now)
		* src/ShSyntax.hpp, ShSyntax.cpp (SH_BEGIN_SECTION, SH_END_SECTION),
			src/ShParser.hpp ShParser.cpp (parseSection),
			src/ShOperation.hpp ShOperation.cpp (SH_OP_STARTSEC, SH_OP_ENDSEC),
			src/ShToken.hpp (SH_TOKEN_STARTSEC, SH_TOKEN_ENDSEC):
		Added user-defined hierarchical block specifiers (SH_BEGIN_SECTION, SH_END_SECTION)
		Added dummy statements STARTSEC and ENDSEC that may only appear at the
		beginning and end of a cfg node respectively to bracket sections (*).

		* src/ShOptimizations.cpp (Straightener):
		Changed to maintain STARTSEC/ENDSEC invariant (*).

		* src/ShStructural.hpp, src/ShStructural.cpp (ShStructural ctor):
		Added a SECTION as a "special" kind of BLOCK structure for user-marked 
		hierarchical sections. (perhaps should just use BLOCK though, but for 
		now this is the easy thing to do to differentiate the two)

		* src/ShSection.hpp, ShSectionImpl.hpp, ShSection.cpp:
		Wrapper around ShStructural that only keeps the tree-structure of sections.
		Graphviz dump that does weird things. 

		* src/ShTransformer.hpp, ShTransformer.cpp (stripDummyOps):
			Removes uselss ops like SECTION markers and so on before final code
			generation. 

			Added a mixin foundation for transforms to save typing
			(@todo haven't actually cleaned up any old transformer, but look at all 
			the copies of operator()(ShCtrlGraphNodePtr node)...)

		* src/ShStatement.hpp, ShStatement.cpp: 
			Changed to allow ops with no dests (and dummy ops with no srcs).
			Fixed a few places elsewhere to deal with this.

	C) Misc Changes 
		* src/ShInfo.hpp, ShInfoImpl.hpp (ShInfo, ShInfoHolder)
			src/ShStatement.hpp, ShStatement.cpp:
		Extracted methods from ShStatementInfo and ShStatement.

		* src/ShOptimizations.hpp, src/ShValueTracking.cpp:
		Added valuetracking of inputs/outputs. 

		* src/ShEvaluate.hpp, ShEvaluate.cpp (evaluate(ShStatement)),
			ShEval.cpp (operator()) :
		Pointed evaluate to ShEval::operator(), and moved over error
		handling for missing ops to operator().
		(@todo can refactor some of the code here with ShInstructions.cpp)

		* src/ShInstructions.hpp, ShInstructions.cpp:
		Changed dest to const& ShVariable  

		* src/ShLibMatrix.hpp (specialized 3x3 det):
		This was slowing down inverse performance.
		(Note: the existing recursive det that breaks out scalar elements _sucks_.
		nxn det should always doable (proof in the margin...) using only swizzled 
		ops on n-vector rows) 

		* src/ShMeta.hpp (ShMeta):
		Added copy constructor since the default no longer works

		* src/ShSwizzle.hpp (ShSwizzle):
		Added a constructor that repeats a given swizzle n times.

	D) Misc Fixes
		* src/ShConstProp.cpp (updateDest):
		Changed updateDest to 
			- init dest to TOP 
			- keep a vector of previous lattice values on each dest
			- update worklist iff change to dest lattice value

		* src/ShOptimizations.cpp (CopyPropagator::operator()):
		Added extra check to prevent copy propagation if ASN is a cast between
		different storage types.

		Moved collectVariables() to the end of optimize()

		* src/ShInternals.hpp, ShInternals.cpp:
		ShVariableReplacer deals with cond vars.

		* src/ShTransformer.cpp (StatementSplitter::updateStatement):
		Long-tuple handling for CSUM, CMUL

		* backends/gl/ArbEmit.cpp (emit_csum):
		Fixed variant problem here.

		* sh/src/ShVariableNode.cpp (ShVariable - clone constructor):
		Fixed how keepUniform behaves.

		* src/ShStorageType.hpp (SH_VALUETYPE_SPECIAL_NONE):
		Changed this constant to the correct value

		* src/ShGenericImpl.hpp, src/ShCastManager.cpp:
		Replaced memcpy with std::copy (safer for range and other future types).

		* src/ShVariant.hpp, ShVariantImpl.hpp:
		Worked out some refcounting issues so internally ops pass around bare 
		pointersinstead of refcounted ones.
		(This makes it possible to re-use the same ops with statically allocated
		variants without accidentally destroying them)

		* src/ShConcreteRegularOpImpl.hpp (LIT):
		Fixed this up a bit 

		* src/ShTextureNode.cpp:
		Force m_texSizeVar to be uniform, for when the texture is generated while 
		building a ShProgram 

	E) Removed interval arithmetic from trunk

		Most of the other changes
		
	
2005-02-07  Francois Marier  <francois@serioushack.com>

	* test/regress: Added unit tests for sum and prod.

	* src/ShLibMisc.hpp, src/ShLibMiscImpl.hpp (join): Added join
	functions for three and four tuples.

2005-02-04  Francois Marier  <francois@serioushack.com>

	* src/*: Made lit an operation (issue74) and compute it according
	to the Arb fragment program spec when in immediate mode. 

	* backends/gl/*: The lit function now uses the actual LIT Arb
	function.

	* backends/cc/*: The lit function is computed according to the Arb
	Fragment program spec.

	* test/regress/lit.cpp.py: Added more test cases and changed
	the definition of the lit function to match the Arb fragment
	program spec.

2005-02-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbEmit.cpp (emit_tex): Handle non-four-tuple
	textures with swizzling/writemasking correctly.

2005-02-01  Francois Marier  <francois@serioushack.com>

	* src/ShMatrix.hpp, src/ShMatrixImpl.hpp: Fixed scalar promotion
	is now done correctly and efficiently.

2005-01-27  Francois Marier  <francois@serioushack.com>

	* src/ShMatrix.hpp, src/ShMatrixImpl.hpp: Assigning a scalar to a
	matrix now creates an identity matrix multiplied by that scalar.

2005-01-26  Bryan Chan <b8chan@cgl.uwaterloo.ca>
	
	* util/ShObjMesh.cpp:
	Improved vertex normal generation.

2005-01-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbEmit.cpp (ArbCode::table): Do not scalarize
	OP_DIVs.
	(emit_div): Emit a single RCP instruction for scalar-RHS divs.

2005-01-25  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	After release 0.7.6:
	
	* src/ShMatrixImpl.hpp (ShMatrix): Fix default constructor to not
	set matrix to identity for inputs.

2005-01-21  Francois Marier  <francois@serioushack.com>

	* src/ShSyntax.hpp, src/ShSyntax.cpp: Added a new function,
	shUpdate(), which uploads any textures and uniform parameters
	which are out-of-date but required on all compilation targets that
	have any programs bound.

	* src/ShBackend.hpp, backends/gl/ArbCode.cpp,
	backends/gl/ArbCode.hpp, backends/cc/Cc.cpp, backends/cc/Cc.hpp:
	The backend code now has an update() method which is called by
	shUpdate().

2005-01-19  Francois Marier  <francois@serioushack.com>

	* src/ShTextureNode.cpp, src/ShTextureNode.hpp,
	backends/gl/GlTextures.cpp, backends/gl/PBufferStreams.cpp: Added
	an option count parameter to the constructor that is used to
	restrict the copy of non-existing data to texture memory.

	* backends/gl/GlTextureStorage.hpp, GlTextureStorage.cpp: Changed
	the glTexImage calls to only allocate the necessary space and
	added glTexSubImage calls to do the actual copying.  Fixes issue151.

2005-01-17  Francois Marier  <francois@serioushack.com>

	* test/regres: Added tests for exp, clamp, frac, sign, max, min,
	pos, sat and sqrt.

	* test/regress/test.hpp: Prevent the host backend from running
	stream programs and segfaulting.

	* test/regress/shtest.py, test/regress/test.hpp: Instead of always
	returning 0, the generated test programs now return 1 if any of
	the tests failed, 2 on ShErrors and 3 on C++ errors.

2005-01-12  Francois Marier  <francois@serioushack.com>

	* test/regress: Added tests for abs, ceil, dot, floor, mod, pow, 
	==, !=, >=, >, <=, and <.
	
	* test/regress/test.hpp: Renamed "res" to "exp" in the test output
	to make it clear that the last line refers to expected output.

	* test/regress/shtest.py (Test.output_footer): Prevent compile
	warning by adding an extra \n at the end of each cpp file that's
	generated.

	* test/regress/test.cpp: The default backend is set to the
	SH_REGRESS_BACKEND environment variable if it exists. It's still
	possible to override this default on the command line.

	* test/regress/Makefile.am: Added a checkall target
	to run "make check" on all backends.
	
2005-01-11  Francois Marier  <francois@serioushack.com>

	* backends/gl/ArbCode.cpp (allocParam): Renamed opengl:binding to
	opengl:state.

2004-12-20  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* examples/binding/*: Small example of using the new
	"opengl:binding" meta information to bind Sh uniforms to
	OpenGL state.

2004-12-20  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShMatrixImpl.hpp (internal):  Fix two  variables  with same
	name to be different.

2004-12-20  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* src/ShMatrix.hpp, src/ShMatrixImpl.hpp: ShMatrix now
	inherits from ShMeta. Removed the existing name() and internal()
	methods. Meta information is stored in the ShMatrix class and all
	meta information is passed along to each internal ShAttrib with
	a ".row[i]" attached.

	* backends/gl/ArbCode.cpp, backends/gl/ArbReg.cpp,
	backends/gl/ArbReg.hpp: Added support for explicit OpenGL
	state binding via "opengl:binding" meta information. Additionally,
	"opengl:readonly" is also supported.

2004-12-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShSyntax.cpp (shBind): Correct order of arguments in shBind
	definition.

2004-12-10  Bryan Chan  <b8chan@cgl.uwaterloo.ca
	
	* backends/gl/ArbCode.cpp: Fixed unnecessary BRA instruction.

2004-12-01  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShSyntax.hpp (SH_WHILE): Remove spurious backslash.

	* backends/cc/Cc.cpp (CcBackend::execute): Cache programs.

2004-11-30  Bryan Chan <b8chan@cgl.uwaterloo.ca>
	
	* backends/cc/CcTextures.hpp (sh_cc_backend_nearest): Fixed the
	floor bug Nils mentioned.  Fixed some other bugs I just noticed.

	* test/regress/tex.cpp.py: Added tests for above two bugs

	* test/regress/div.cpp.py: Added some integer div tests that may
	be related to the FOR loop weirdness on GPU.

2004-11-28  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	* src/ShHashMap.hpp (ShPairHashMap::operator()): Added missing
	typedef.

	* src/ShFractionImpl.hpp (cbrt, exp, exp2, exp10):
	Fixed bug. 

2004-11-28  Bryan Chan <b8chan@cgl.uwaterloo.ca>
	* src/ShUtility.hpp (MatchTemplateType, TemplateParamterType):
	Added some mildly useful template voodoo. 

	Cleaned up parts of storage types 
	Switched all template parameters back to typename from ShValueType.
	Reorganized some things to make it easier to add user-defined types.
	* src/ShStorageType.hpp, ShStorageTypeImpl.hpp:
	Added some infrastructure needed for typename params.

	* src/ShFraction.hpp, ShFractionImpl.hpp:
	Added a fraction type that uses appropriate temporary types for
	ops where intermediates may overflow.
	Handles either clamped or overflow mode (but overflow commented out).

	* src/ShHalf.hpp:
	Added half type (slow but functional).  Should pop in OpenEXR's half as a
	replacement at some point, or add a autoconf flag to use one or the other. 

	* src/ShVariableNode.hpp, ShVariableNode.cpp (clone):
	Turned the different versions of this function into a single function,
	with parameters ordered by frequency of expected usage.

	* src/ShHashMap.hpp:
	Wrapper around __gnu_cxx::hash_map when using GNU libstdc++ 
	and stdext::hash_map when using MS VC.Net that has the subset
	of methods common to both.
	Some extra structs for handling multiple keys. 

	* configure.ac:
	Fixed merge mistake (clobberred version number)

	* the rest:
	Search & replace lots of ShValueType back to typename 
  Added new files to the Win32 build scripts.

2004-11-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShSyntax.cpp: Small changes for immediate-mode control flow.

	* src/ShSyntax.hpp: Allow immediate-mode use of control flow
	statements.

2004-11-16  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShBackend.cpp: Remove spurious debug statements.

2004-11-12  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	* src/ShInternals.cpp (operator()(ShCtrlGraphNodePtr)): Fixed
	  VarReplacer so it replaces the ShVariable in branch conditions
	  as well as the block.
	      
2004-11-11  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	* backends/gl/ArbCode.cpp (print):
	  Fixed	some bugs printing out half temp registers.
	  
2004-11-09  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	* backends/cc/Cc.cpp, CcTextures.hpp: Checked in the wrong version
	of these files

	* util/ShFunc.hpp, ShWorley.hpp ShNoise.hpp: hid some function
	declarations from the compiler

	* win32.mk: Fixed error.

2004-11-08  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	Merged arithmetic r1672 into main branch
  
2004-11-07  Bryan Chan <b8chan@cgl.uwaterloo.ca>

	Merged in trunk up to r1671. 

	* src/ShTypeInfo.hpp (ShCommonType):
	Fixed bad template params caught by gcc 3.4

	* backends/CcEmit.cpp, CcTextures.hpp (emitTexLookup):
	Implemented clamping, wrapping modes properly

2004-11-05  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	The following changes were made after the 0.7.5 release.
	
	* backends/gl/PBufferStreams.cpp: Implemented SH_OP_LOOKUP in arb
	backend stream implementation.

	* src/ShChannelImpl.hpp (operator[]): Implemented operator[].

	* src/ShChannel.hpp: Added operator[] for indexed stream lookup.

	* src/ShStatement.cpp: Add SH_OP_LOOKUP information.

	* src/ShStatement.hpp: Add SH_OP_LOOKUP for indexed stream lookups.

	* src/ShChannel.hpp: Remove const version of operator(). It's
	always const.

2004-11-05  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShWrap.hpp, src/ShInterp.hpp, src/ShClamping.hpp: More
	missing "this->" parts. Also fixed indentation.

	* src/scripts/ShAttribImpl.hpp.py: Refer to parent members
	(m_node) using "this->" to disambiguate them. Required to compile
	under gcc 3.4.

	* src/scripts/semantic.py: Refer to parent members (m_node,
	m_swizzle, m_neg) using "this->" to disambiguate them. Required to
	compile under gcc 3.4.

	* src/ShChannelImpl.hpp: Include ShAlgebra.hpp. Fixes gcc 3.4
	compile failure.

	* src/ShOptimizations.cpp, src/ShValueTracking.cpp,
	src/ShConstProp.cpp: Fixed several gcc 3.4 compile failures by
	removing 'template' qualifier for template member function calls
	that don't need it.

2004-11-05  Bryan Chan <b8chan@cgl.uwaterloo.ca>
  Checked win32 changes against linux.

  * backends/cc/Cc.cpp:
  I will not write infinite loops. I will not write infinite loops. I will 
  not write...


2004-11-04  Bryan Chan <b8chan@cgl.uwaterloo.ca>
  Win32 port.  Not well tested yet, but examples run fine.

  * win32/* :
    Added new files to the win32 projects & solution 

  * src/* :
    Lots of little fixes to get Win32 compiling.
    Workaround for VC.NET 2K3 compiler weirdness in 
    ShVariableType.hpp (changed ShValueType from enum to int)
    And #ifdeffed out every case where ShLib* contains a function
    declaration with a separate definition in ShLibImpl* (because 
    VC thinks they're different functions).

  * backends/cc/CcTexturesString.cpp:
    Changed the texture lookup code string to an array of strings
    because the VC scanner barfed at one long string on a single line. 

2004-11-02  Bryan Chan <b8chan@cgl.uwaterloo.ca>
   Merged trunk up to r1654
   Fixed the spacing in the table below.


2004-11-02  Bryan Chan <b8chan@cgl.uwaterloo.ca>
	* src/ShMeta.hpp, ShMetaImpl.hpp:
	  Make ShMeta only contain an unallocated MetaMap. 
		Inline all functions (I)
    (Other easy ways to slim the ShVariableNode include 
    pulling out the dependency information and uniform locking
    variables into a structure indexed by node ID)

	* src/ShSwizzle.hpp, ShSwizzleImpl.hpp ShSwizzle.cpp:
		Backed out changes from Oct. 28 (r1647) and started over. 
    Union uchar[4] and int* to make it less restrictive. 
    The uchar only gets used for m_srcSize < 256 and m_size <= 4.
		Sped up identity check.  (II)

  * src/ShConcreteRegularOpImpl.hpp ShConcreteCTypeOpImpl.hpp ShEval.hpp
	 	(ShConcreteRegularOp, ShConcreteCTypeOp) :
    removed some unnecesary ref counting on operators (III)

  * src/ShGenericImpl.hpp (setVariant):
	  asn/memcpy directly from the array of data for non-negative identity swiz (IV).	

	* src/test/regress/performance:
	  Checked in some tests & added a few more.  
		results/ holds prospect logs from r1647 and checked in version.

    All tests run x 5 on inigo (P4 2.60 Ghz, gcc 3.3.4-6sarge1, -O2)
                   trunk    arith -> (I) ->  (II) -> (III) -> (IV)
    compile        10.54    11.20     #     10.96     #        # 
    mat_asn_scal    4.54     9.70    8.65    5.85     #        #	 
    mat_asn_vec     0.77     3.28    3.00    2.25    2.17     0.81 
    mat_mul         7.85     8.75    8.44    6.03    5.65      # 
    vec3_add        4.14     4.89    4.30    3.17    2.95     2.88 
    vec3_add_swiz   8.00    10.91   10.45    6.56    6.15     6.02 
    (constprop in compile is slightly slower since it now needs to work on
    variants, but otherwise computation is a bit faster)   

    sphere 100^2    5.78                                      6.22 
    sphere 1024^2  11.51                                     10.13 
    scene 100^2    18.5                                      19.3
    scene 256^2    46.6                                      25.6
    (The code generated by the updated cc backend takes a touch longer to
    compile, but the stream program runs lickety split.  Not sure why yet,
    but prospect logs point to the texture lookup function)

    trunk = r1652, arith = r1647
    # = change < 1% 
    Times are usually repeatable to within +-2% between runs,
    The occasional test varies wildly (over 5%) between compiles 
    probably because of dynamic memory allocation overhead.    

    Descriptions
    compile         5000 compiles to cc backend with optimizations
    mat_asn_scal    100000 asn matrix elements as scalars  (from libsh-devel list)
    mat_asn_vec     100000 asn matrix rows as vectors (from libsh-devel list)
    mat_mul         30000 4x4 matrix-matrix multiplication
    vec3_add        1000000 vec adds (twice simple vec below)  
    vec3_add_swiz   1000000 vec adds, all operands swizzed  
    sphere, scene   Gabo's raytracer


2004-10-29 Bryan Chan <b8chan@cgl.uwaterloo.ca>
	* src/ShSwizzle.hpp, ShSwizzleImpl.hpp ShSwizzle.cpp:
		Assume swizzles only for small tuples ==> use char size, srcSize, indices 
		Union of char[4] and char* to prevent allocation for small swizzles
	
	* src/ShVariableNode.hpp, ShVariableNode.cpp (ShVariableNode, rangeVariant):
		Fixed bug setting lower/upper bounds.  
		Moved some of fields around to give better alignment. 

	==> simple vec test = 1.92s, matrix mul test = 6.15s 


2004-10-28 Bryan Chan <b8chan@cgl.uwaterloo.ca>
	Merged trunk up to r1646

	* in a few places:
	Fixed bad search/replaces "Viberiu" -> "Tiberiu"

	* src/ShMatrix.hpp, ShMatrixImpl.hpp:
	Checked in the wrong version a few hours ago.

  * src/ShVariable.hpp, ShVariable.cpp (loadVariant, updateVariant):
  loadVariant opened up a hole into the internals that made it possible 
  to change a values without triggering dependent/backend updates
  updateVariant plugs the hole.
  (both of these are intended only for internal use)
  -this slows down the vec test below to about 2.40s, but doesn't
  change matrix mul significantly (there's too much matrix overhead elsewhere)
  

2004-10-28 Bryan Chan <b8chan@cgl.uwaterloo.ca>
Performance Tuning
------------------
	Test cases (all on fezzik):
	simple vec = 500000 vec adds, matrix mul = 30000 4x4 matrix muls

	Changes (earliest attempts at top, to latest attempts at bottom)
  * src/ShVariant.hpp, ShVariantImpl.hpp (alloc, new, delete):
  Make ShDataVariant objects allocate using memory pool 

	==> simple vec test = 5.05s, matrix mul test = 11.15s

	* src/ShCastManager.hpp, ShCastManager.cpp (doCast),
		ShVariantCast.hpp, ShVariantCastImpl.hpp (doCast)
		ShVariable.hpp, ShVariable.cpp, (setVariant, getVariant, loadVariant),
		ShVariableNode.hpp, ShVariableNode.cpp (setVariant, getVariant),
		ShInstructions.cpp (all ops), ShEval.cpp (operator()),
		ShConcreteCTypeOpImpl.hpp, ShConcreteRegularOpImpl.hpp (XPD):
  Removed unnecessary copying, refcounting during casts.
	Reduced passing around of refcounted variants.
	Uses original src/dest arrays for computation if they are not swizzed/neged
	and don't require casting (needed to special case XPD op)
	(other non LINEAR ops work without change.  @todo type - doc this for future op implementers) 

	==> simple vec test = 3.05s, matrix mul test = 9.63s 

	* src/ShSwizzle.hpp, ShSwizzleImpl.hpp, ShSwizzle.cpp:
	Inlined some of the small, more frequently used functions
	like the 1-element and copy constructors.

	==> simple vec test = 2.20s, matrix mul test = 8.75s 

	trunk r1638 run times 
	simple vec = 2.15s, matrix mul = 7.95s

	Note: this isn't really fair since some optimizations above
	would most likely help trunk as well, but now we can almost 
	pretend there's no discernable slowdown... 

	* src/ShEval.cpp (getEvalOpInfo):
	Made this faster and cache previously encountered operations. 
  (huge improvement...old linear search was moronic)

Cleanup
-------
	* ShVariableType.hpp, and a few lines in many other files: 
	Changed the storage type template parameter from a c++ typename 
	to an enum. (This breaks backward compatibility unfortunately,
	but makes more sense)

	* src/ShDataType.hpp, ShDataTypeImpl.hpp
		src/ShEval.hpp ShEvalImpl.hpp (_shInitFloatOps, _shInitIntOps),
		src/ShConcrete*Op:
	Added data types corresponding to each storage type.
	One data type as used for host computation, and one for storage
	in memory (possibly the same).
	Added clamps for fractional types. 

	* src/ShGraphImpl.hpp (floydWarshall):
	Fixed FirstStepMap to give the first instead of last step. 

Half/Fractional Support
-----------------------
	* half/frac tex/stream in cc backend 
	and signed frac in arb backend deferred until Sylvain's framework in place 
	(these are easily done as a simple host-side filter on the data and/or 
	slight change in the lookup)  

	* All the other types should work in textures, and all types
	should work in computation (only weakly tested...)

	* ShTypeInfo.hpp ShTypeInfoImpl.hpp ShTypeInfo.cpp (ShCommonType,
		shTypeInfoInit, addCasts):
	Cleaned up automatic type promotion, type conversions. 
	Added casts on memory <-> host data types into the framework so
  backends can easily convert tex/stream data types 
  (Can fix speed issues later, but this prevents a Cartesian product 
  blowup in caster objects)

	* src/ShTypeConvertTransformer.cpp:
	Added in conversions for fractional types -> float

	* backends/gl/ArbReg.hpp, ArbReg.cpp (ArbRegType)
		GlTextures.cpp (shGlInternalFormat, shGlType), 
		GlTextureStorage.cpp (bindTexture), 
	PBufferStream.cpp (execute),
	ArbCode.cpp (ArbCode, allocTemps):
	Added in half, fractional textures,
	Request for transformation of half/fractionls used in computation to float,
	Hacked in a few lines to allocate halfs registers (NV_fragment_program only).

	* backends/cc/CcTextures.hpp, CcTexturesString.hpp, Makefile.am:
	Fixed some bugs in the texture lookup functions.
	Added some hackery to include the contents of CcTextures.hpp into the
	cpp file generated for a stream kernel. 

Testing
-------
	* test/regress/shtest.py (ImmediateTest, GenTexture, ImageTexture),
		add_im.cpp.py, tex.cpp.py :
	Modified streamtest.py -> shtest.py for immediate mode.  
	Added destcall mode to Call for testing intrinsics.
	Added some very basic texture lookup tests.

	* test/regress/cbrt.cpp.py, cmul.cpp.py, csum.cpp.py, rnd.cpp.py:
	Tests for new ops. (some need to be implemented in the backends) 

2004-10-28  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/gl/WGLPBufferStreams.*: Changed pbuffer management
	code, removed context tracking and replaced with list of
	cached pbuffer/contexts. 

2004-10-28  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/gl/ArbCode.*: The ArbCode was holding a reference
	to its associated program causing a cyclic dependency. The smart
	pointer was changed to a raw pointer, alleviating most of the memory
	leaks.

	* backends/gl/WGLPBufferStreams.*: Changed pbuffer management
	code, removed context tracking and replaced with list of
	cached pbuffer/contexts. 

	* backends/gl/GLXPBufferStreams.*: Changed pbuffer management
	code, removed context tracking and replaced with list of
	cached pbuffer/contexts. 

	* backends/gl/GlTextures.*, backends/gl/GlTextureStorage.*,
	backends/gl/Arb.*, backends/gl/GlBackend.*,
	backends/gl/PBufferStreams.*: Removed all the context bookkeeping
	code. We now assume that contexts share the same texture/program/
	display list space.

2004-10-28  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/cc/Cc.cpp: Generated code changed to use
	static variable, some linux ld versions caused symbol
	collisions leading to segfaults

2004-10-27  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/gl/GlBackend.*, backends/gl/WGLPBuffersStreams.cpp:
	Create an OpenGL context if there already isn't one already
	to bootstrap the calls to wglGetProcAddress and for pbuffer creation.

2004-10-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstProp.cpp (ConstPropInfo): Respect "opt:lifting"
	metadata. This should be particularily useful for bypassing Sh's
	uniform updating facilities (to trade convenience for speed).

	* backends/gl/ArbCode.cpp (generate): Remove debugging output.
	(allocateRegister): Throw exception from here to be caught further up.
	(allocRegs): Catch exception from allocateRegister and provide
	more useful error message.

	* src/ShLinearAllocator.hpp: Remove spurious semicolon

	* src/ShStatement.cpp: Set arity of PAL to 2 instead of 1.
	This took a while to track down!

2004-10-25  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* examples/particle/main.cpp: Use nicer colours.

2004-10-24  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* win32/*: Added Visual Studio .NET solution/project files.

	* examples/particle/*: Added a stream example, loosely based
	on the particle code from the book.

	* backends/gl/Makefile.win32: Added WGL pbuffer source files.

	* backends/gl/ArbBackend.cpp: Changes to instantiate GLX streams
	on linux and WGL streams on windows.

	* backends/gl/GlBackend.hpp, backends/gl/GlBackend.cpp: Added WGL
	stuffs to load WGL_ARB_pbuffer and WGL_ARB_pixel_format extensions.

	* backends/gl/PBufferStream.cpp, backends/gl/PBufferStreams.hpp:
	Factored out the GLX specifics, leaving only the code common to both
	WGL and GLX. Added a few pure virtual functions that are implemented
	by the platform dependent classes.

	* backends/gl/WGLPBufferStreams.cpp, backends/gl/WGLPBufferStreams.hpp:
	Added WGL specific pbuffer code.

	* backends/gl/GLXPBufferStreams.cpp, backends/gl/GLXPBufferStreams.hpp:
	Added GLX specific pbuffer code (transplanted from old PBufferStreams.cpp).

2004-10-22  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShTransformer.cpp: Instead of popping the current program,
	push 0, when constructing uniforms.

	* src/ShProgramNode.cpp (compile): More exception safety fixes.

	* backends/gl/ArbCode.cpp (upload): Call shError() when the driver
	doesn't allow code to be uploaded (e.g. due to failing instruction
	limits).
	(generate): Exception safety fix (leave context and rethrow
	exception if we get one).

	* src/ShException.cpp (ShBackendException): Implement
	ShBackendException constructor.

2004-10-22  Sylvain Vasseur  <sfvsasse@cgl.uwaterloo.ca>

	* src/Makefile.win32: Add ShMemoryDep file.

2004-10-21  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/cc/Cc.cpp, backends/cc/Cc.hpp: Completed Win32 support
	for cc backend. Added 'init' function to generated code to bootstrap
	texture lookup functions

	* src/ShImage.cpp: savePng on Win32 generates bad images, fopen
	need a "wb" instead of "w".

	* src/ShPaletteNode.hpp: Added SH_DLLEXPORT

2004-10-21 Bryan Chan <b8chan@cgl.uwaterloo.ca>
  Merged trunk up to r1606

  * src/ShTypeInfo.hpp, ShTypeInfoImpl.hpp: 
  Added typedefs for host & memory storage types. 

  * src/ShVariantFactory.hpp, ShVariantFactoryImpl.hpp
    backends/gl/PBufferStream.cpp GlTextureSTorage.cpp:
  Added methods to allocate variants using the memory storage type.
  
  * src/scripts/semantic.py, ShAttribImpl.hpp.py, 
    src/ShGeneric.hpp, ShGenericImpl.hpp :
  Changed all scalar value constructors/returns to use 
  the host storage type instead of T.

  * test/regress/test.hpp:
  Changed streams to use MemoryType instead of ValueType.

2004-10-20  Sylvain Vasseur  <sfvsasse@cgl.uwaterloo.ca>

	* src/ShMemoryDep.hpp: Implement dependencies with a memory object
  
	* src/ShMemory.hpp (ShMemory::add_dep): Add function to link with
  dependencies.
	(ShMemory::flush): Add function to use the dependencies.
	(ShStorage::dirtyall): Add function to mark dirty without
  a sync before.
  
	* src/sh.hpp: Include ShMemoryDep.hpp.
  
	* src/Makefile.am: Add ShMemoryDep files.

2004-10-20  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.cpp (print): Handle ARRAYMOV instructions.
	(allocRegs): Add palette allocation code.
	(allocPalette): Implement.
	(printVar): Only print swizzle if do_swiz is set.
	(allocRegs): Allocate address register if necessary.
	(allocParam): Use m_numParamBindings.
	(ArbCode): Initialize m_address_register.

	* backends/gl/ArbEmit.cpp (emit_pal): Implement this.
	(table): Handle SH_OP_PAL.

	* backends/gl/ArbCode.hpp: Keep track of parameters and parameter
	bindings separately. Add m_address_register member. Add do_swiz
	parameter to printVar. Add emit_pal function. Add allocPalette function.

	* backends/gl/ArbInst.cpp (arbOpInfo): Add information for ARL and ARRAYMOV.

	* backends/gl/ArbReg.cpp (printDecl): Make use of bindingCount.

	* backends/gl/ArbInst.hpp: Add SH_ARB_ARL and SH_ARB_ARRAYMOV instructions.

	* backends/gl/ArbReg.hpp (ArbReg): Add bindingCount member for
	parameter arrays.


2004-10-20 Bryan Chan  <b8chan@cgl.uwaterloo.ca>
  Merged trunk up to r1595 into arithmetic (but did not test out the windows
  changes).

	Merged trunk up to r1592 into arithmetic.
	Transferred updated gcc backend to cc, like trunk. 

	* src/ShPalette.hpp, src/ShPaletteImpl.hpp (ShPalette)
		src/ShPaletteNode.hpp, src/ShPaletteNode.cpp (ShPaletteNode):
		Added type index of T::ValueType for an ShPalette<T> to 
		ShVariableNode constructor call so that
		ShVariable::typeIndex() will work for palettes.

2004-10-20  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/cc/Cc.cpp, backends/cc/Cc.hpp: Win32 port of compiler
	backend.

	
2004-10-19 Bryan Chan  <b8chan@cgl.uwaterloo.ca>
  * test/regress/streamtest.py, test.hpp:
  Added storage type test capabilities. 

  * src/ShTransformer.hpp, src/ShTypeConvertTransformer.cpp (convertToFloat):
  Use dependent uniforms instead of a non-float to float variable
  map passed to backend.

	* backends/gl/GlTextures.?pp, 
		backends/gl/GlTextureStorage.?pp,
		backends/gl/PBufferStreams.cpp:
	Add non-float storage-type textures/streams.
	(Costly conversion occurs for types not supported natively
	through OpenGL.  We can speed this up/rethink later on)

  * backends/gcc/Gcc.hpp, Gcc.cpp, GccEmit.cpp, GccTextures.hpp:
  Tabulated the mess in emit(ShStatement) for LINEAR ops, 
  Changed all traces of float* to void*, and added administrative code required for 
	proper casting to the right storage types.
	Cleaned up texture lookup to handle new storage types. (untested)
	(Changed to nearest-neighbour, clamp to edge only.  Assume
	interpolation/wrapping and other abstractions implemented as transformers)

	* src/ShVariant.hpp src/ShVariantImpl.hpp, 
		src/ShVariantFactory.hpp, src/ShVariantFactoryImpl.hpp, 
		src/ShEval*, 
		src/ShConcrete*:
	Cleaned up ShVariant and ShDataVariant classes, switched to a self-managed
	data array instead of vector, and added constructors to manage external data
	(useful for working/casting ShHostStorage objects that hold a single data type)

	* src/ShTypeInfo.hpp, src/ShTypeInfoImpl.hpp, src/ShContext.hpp:
	Moved type->index, index->type mappings to templates in TypeInfo instead
	of run-time generated in ShContext.
	(The templates are a little clumsy, but makes sense unless we want to be able 
	to change the set of available storage types at runtime)

2004-10-19  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* configure.ac, backends/Makefile.am, backends/cc/Makefile.am,
	backends/cc/Cc.cpp, backends/cc/Cc.hpp, test/regress/test.cpp:
	Renamed Gcc to Cc, Windows port of compiler backend to follow...

2004-10-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstProp.cpp (ConstProp::ConstProp): Handle palette nodes.

	* src/ShVariableNode.cpp (name): Handle palette nodes.

	* src/Makefile.win32: Add palette source files.

	* src/Makefile.am: Add palette source files.

	* src/sh.hpp: Include ShPalette.hpp.

	* src/ShStatement.cpp (opInfo): Add info for SH_OP_PAL.

	* src/ShStatement.hpp (ShOperation): Add SH_OP_PAL.

	* src/ShVariableNode.hpp (ShBindingType): Add new SH_PALETTE
	binding type.

	* src/ShProgram.hpp (ShProgram): Add palette accessor function
	wrappers.

	* src/ShProgramNode.cpp (collectVar): Look for palettes.

	* src/ShProgramNode.hpp (ShProgramNode): Add palette accesor functions.

	* src/ShPaletteNode.cpp: Implement ShPaletteNode.

	* src/ShPaletteNode.hpp: Add ShPaletteNode class for internal
	palette representation.

	* src/ShPaletteImpl.hpp: Add implementation for ShPalette.

	* src/ShPalette.hpp: Add initial palette support.

2004-10-14  Bryan Chan  <b8chan@cgl.uwaterloo.ca>
  Merged main branch up to r1559 into this branch.

  * src/ShTypeConvertTransformer.cpp:
  Bug fix for uniform flag on temp variables.

  * src/ShConstProp.cpp:
  Fix to figure out storage type of a valuenum properly.

2004-10-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShGenericImpl.hpp (operator%=): Actually do a modulo, not a
	divide. Woops.

2004-10-13  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstProp.cpp (updateDest): Temporarily fixed issue with
	detecting whether all srcs are uniform.

2004-10-13  Bryan Chan <b8chan@cgl.uwaterloo.ca>
  Merged main branch up to r1510 into this branch, minor
	fixes for shrike (which now unfortunately takes > 30
	seconds to initialize on kurr :-O )

  Still a few known bugs, but will check if moving to the latest trunk 
  fixes the problems.

  * src/ShCloak*:
  Changed to ShVariant* to prevent potential Star Trek licensing issues. 

	* configure.ac: Changed AC_CONFIG_SRCDIR to ShVariable.hpp, since
	ShAttrib.hpp is now generated automatically.

2004-10-12  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.cpp (printSamplingInstruction): Output
	SH_ARB_TXD instructions properly.

	* backends/gl/ArbEmit.cpp (emit_tex): Handle SH_OP_TEXD (only 2D
	for now).

	* backends/gl/ArbInst.hpp (struct ArbInst): Add max_num_sources,
	set to four, add constructor for four sources.

	* backends/gl/ArbInst.cpp (arbOpInfo): Add operation info for SH_ARB_TXD.

	* backends/gl/ArbInst.hpp (enum ArbOp): Add SH_ARB_TXD.

	* src/ShBaseTextureImpl.hpp (ShBaseTexture2D::operator()):
	Implemented lookup-with-derivatives operator.

	* src/ShBaseTexture.hpp (ShBaseTexture2D): Added
	lookup-with-derivatives operator, only for 2D for now.

	* src/ShStatement.cpp (opInfo): Added opInfo for SH_OP_TEXD.

	* src/ShStatement.hpp: Added SH_OP_TEXD.

	* backends/gl/ArbEmit.cpp: Only emit texture lookups on NVVP3 (was NVVP2).

	* src/ShConstProp.cpp (struct FinishConstProp): Skip the statement
	for uniform lifting if we've replaced it with a constant.

2004-10-08  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShInstructions.cpp: Inline helper functions.

	* src/ShRefCountImpl.hpp: More inlining.

	* src/ShVariableNode.cpp (ShVariableNode): Only construct m_eval
	if we have to (i.e. in functions that use it).

	* src/ShSwizzle.hpp: Use a simple array instead of std::vector.

	* src/ShGenericImpl.hpp: Inline lots of stuff.

	* src/ShMeta.hpp: Inline default constructor.

	* src/scripts/ShAttribImpl.hpp.py: More inlining.

	* src/scripts/semantic.py: Inline those member functions.

	* src/ShLib.hpp (SH_SHLIB_USUAL_NON_UNIT_OPS_RETTYPE): Add all
	versions of operator/.

	* test/regress/regress.py: Remove this file.

	* test/regress/add.cpp.py, test/regress/mul.cpp.py,
	test/regress/div.cpp.py, test/regress/cos.cpp.py,
	test/regress/sin.cpp.py: Added the first of the new regression
	tests.

	* test/regress/common.py: Add file containing some useful
	functions for regression testing (well, just one right now).

	* test/regress/streamtest.py: Add beginnings of new regression test engine.

	* test/regress/Makefile.am: Remove old regression testing cruft.

2004-10-08  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* Makefile.win32, backends/Makefile.win32, backends/gl/Makefile.win32,
	src/Makefile.win32, util/Makefile.win32, win32.mk: Updated makefiles
	to support release/debug only builds, turning off dependency
	generetion and explicit targets for release and debug builds.

2004-10-07  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* win32.mk, src/Makefile.win32: makedepend doesn't recognize
	/I and /D, changed all references to -I and -D.

	* src/ShMatrix.hpp: Previous SH_DLLEXPORT though to be
	misplaced was actually unnecessary.
	
2004-10-07  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* src/ShInstructions.cpp: No roundf or cbrtf on Win32, created
	inline replacements using floor and pow.

	* src/ShLibMiscImpl.hpp: VC++ complained about unknown type ShProgram,
	added appropriate include.

	* src/ShMatrix.hpp: Fixed misplaced SH_DLLEXPORT.
	
2004-10-06  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariableNode.cpp: Added optional memory pool
	support implementation. Disabled right now.

	* src/ShVariableNode.hpp: Added optional memory pool
	support. Disabled right now.

	* src/ShPool.cpp: Added memory pool implementation.

	* src/ShPool.hpp: Added optional memory pool interface. Disabled
	for now.

	* src/ShVariableNode.cpp (~ShVariableNode): Fix memory leak by
	deleting m_eval. doh.

	* src/ShLibMatrixImpl.hpp (rotate): Added 2D version of rotation.

	* src/ShVariable.cpp (operator<<): Simplify this a little.

	* src/ShInstructions.cpp: Implement shCBRT and shRND.

	* src/ShProgram.cpp: Add operator() on streams here.

	* src/ShChannelImpl.hpp (operator()): Add operators for programs
	to channels.

	* src/ShLibClamp.hpp (round): Add this function.

	* src/ShLibArith.hpp (cbrt): Add this function.

	* src/ShStatement.cpp: Add opInfo for CBRT and RND.

	* src/ShStatement.hpp: Add CBRT and RND.

	* src/ShLibMisc.hpp (freeze): Add this function to turn uniforms
	into constants.

	* src/ShLibMatrixImpl.hpp: Added colmat, rotate, translate, scale
	(although 2D rotate is still missing).

	* src/ShMatrix.hpp: Many much needed comment fixes. Also, moved
	operator<< out of ShMatrix.

	* src/ShVariable.hpp (ShVariable): Add clone member function.

2004-10-05  Bryan Chan <b8chan@cgl.uwaterloo.ca>
  Small fixes to make shrike work.  Merging in main branch next.  

  * src/scripts/semantic.py, src/scripts/ShAttribImpl.hpp.py:
  Added templated versions of the scalar constructors.

  * src/ShLib.hpp, src/shLibArith.hpp, src/ShLibGeometry.hpp:
  Fixed some template argument bugs.

  * src/ShTypeConvertTransformer.cpp, src/ShInstructions.cpp,
    backends/gl/Arb.cpp backends/gl/ArbCode.cpp:
  Removed obsolete debug messages. 

2004-10-05  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShGenericImpl.hpp (operator=(T)): Make the temporary
	constant attribute an SH_CONST instead of an SH_TEMP.

2004-10-05  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* win32.mk: Updated for building with Visual C++ 2005
	Express Beta 1
	
2004-10-04  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* backends/gl/ArbCode.cpp, backends/gl/ArbEmit.cpp,
	src/ShImage.cpp, src/ShInstructions.cpp, src/ShLib.hpp,
	src/ShLibClamp.hpp, util/ShFuncImpl.hpp: Removed use of
	_USE_MATH_DEFINES and undefines of min and max, now
	controlled via win32.mk.

	* backends/gl/Makefile.win32, src/Makefile.win32,
	util/Makefile.win32, win32.mk: General WIN32 makefile
	cleanup/overhaul.

2004-10-01  Bryan Chan <b8chan@uwaterloo.ca>
  Another checkin for storage types. Transformers are now in place
	so floating point (not including half) and signed int types 

	* test/regress/regress.py test/regress/test.?pp:
	Added testing of immediate mode. 

	* ShInterval*: Interval Type
	Mucked around with exising NuS class to make an interval type.
  (some functions incomplete, like trig)	

	* ShTransformer*, ShIntervalConverter.cpp, ShCtrlGraph.*, ShBasicBlock.*:
	Added a transformer that turns interval temps into floats
	by splicing in ShProgram fragments in the place of statements.

	* ShTypeConvertTransformer*:
	Added a transformer that turns non-float variables/statements
	into float.
	(Currently only does int, double -> float, but commented out
	framework should handle all standard Sh types)

	* ShEval*, ShConcrete.*Op*, ShInstructions.?pp,
		ShLibInterval*:
	Added in interval ops (LO,HI,SETLO,SETHI)
	Cleaned up evaluation and made it more flexible.

	* ShOperation.cpp:
	Merged in changes from main branch

	* ShCloakCast*, ShCastManager*:
	Used internally to manage casting between different variable storage types 

	
	* ShGraph*: 
	Added some a adjacency-list based graph class with some basic 
	functions (needs cleaning).  Used for operator resolution. 

	* ShStatement.*:
	Merged in ShStatementInformation from main branch.

	* ShBaseTexture*, ShLib*, ShAttrib*, and ShAttrib subclasses:
	Changed binary/ternary/assignment operators and texture lookup to 
	allow operands of different variable storage types.

2004-09-24  Sylvain Vasseur  <sfvvasse@cgl.uwaterloo.ca>

	* src/ShLibClampImpl.hpp (max): Specialize unary max for N==1.
	(min): Specialize unary min for N==1.

2004-09-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbEmit.cpp: Implement emit_kil and use it to emit
	KIL instructions. Fixes issue146. Thanks to Bryan Chan for
	pointing this out.

	* backends/gl/ArbCode.hpp: Add emit_kil member function.

2004-09-09  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* Fixed some brokenness on Windows.

2004-09-08  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstProp.cpp: Fix a bunch of harmless warnings.

	* src/ShOptimizations.cpp (optimize): Don't do constant
	propagation/uniform lifting unless the optimization level is at
	least two.

	* src/ShConstProp.cpp (struct FinishConstProp): Don't lift values
	which are partially not uniform.

2004-09-07  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/GlTextures.cpp (bindTexture): Added support for
	opengl:preset metadata, and set opengl:texid metadata.

2004-09-01  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstProp.cpp (ConstProp::updateDest): Push definitions
	onto the worklist when op = SH_OP_ASN if appropriate.
	(Uniform::operator==): Two constant uniforms are equal if their
	values are equal.
	(Value): Add an operator==, and simplify lookup() using this.
	Add lots of debugging support.
	(propagate_constants): Use TOP as the base case for building the
	meet over all possible values, instead of the current value of the
	use's cell.

	* src/ShContext.hpp: Add mechanism to disable particular
	optimizations (not used by the optimizer yet).

2004-08-30  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstProp.cpp (struct FinishConstProp): Ignore nodes whose
	RHS is all (uniform OR constant), unless they're writing to output
	(or inout) nodes.
	(struct FinishConstProp): Fix boolean expressions.

	* src/Makefile.am (libsh_la_SOURCES): Split some of
	ShOptimizations.cpp into ShConstProp.cpp and ShValueTracking.cpp

2004-08-28  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp (Cell::Cell): Don't use the swizzle to
	make the index, the swizzling is represented implicitly when
	setting up a statement-based cell.
	(propagate_constants): Set negatives appropriately when
	propagating uniforms.
	(...): Added support for mixed (constant/uniform) operations to be
	lifted. Seems to be slightly broken still.
	(ConstProp::updateDest): Handle SH_OP_ASN specially.

2004-08-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp: Added most of the uniform lifting code.

2004-08-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp (ConstProp): Set destinations to either
	BOTTOM or CONSTANT but never top.
	(propagate_constants): Consider all use-def information for uses
	that need to be updated when computing the new lattice cell
	values.
	* test/regress/Makefile.am: Added test.hpp everywhere.

2004-08-24  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp: Add copy propagation, clean up a few
	things.

2004-08-23  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/PBufferStreams.cpp (execute): Optimize is spelled
	"optimize", not "optmize".

	* src/ShOptimizations.cpp: Mark writes to inputs as live. This is
	actually over pessimistic, but works for now.

	* src/ShVariableNode.cpp (ShVariableNode): Constants are not
	uniforms.

	* src/ShOptimizations.cpp (ConstProp::updateDest): Use SH_CONST
	for our temporary evaluator variables so that they have values
	even if we are inside a shader program definition.

	* src/ShEvaluate.cpp (evaluate): Push a null program onto the
	definition stack in ShContext to force our operations to execute
	in immediate mode, even if we are in a program definition.

	* src/ShOptimizations.cpp (forward_substitute): Copy this from
	ShOptimzer.cpp (it used to be called "move elimination" but
	forward substitution is the proper term).

	* src/ShSyntax.cpp (shEndShader): Use optimize() from
	ShOptimizations.hpp instead of ShOptimizer. Also did this in
	backends/*/* and src/ShAlgebra.cpp.

	* src/Makefile.am (libsh_la_SOURCES): Remove ShOptimizer.hpp and
	ShOptimzer.cpp.

	* src/ShStatement.hpp: Remove ud and du members from ShStatement.

	* src/ShStatement.cpp (operator=): Implement operator=.

	* src/ShStatement.hpp: Add operator=() for ShStatements.

2004-08-21  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp (struct FinishConstProp): Use the
	constant propagation information, and remove it when we're done.

2004-08-20  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp (ReachingDefs::Definition): Keep a
	disable_mask bitset to keep track of definitions overwriting each
	other in a single block. This is used when constructing gen.
	(DefFinder::operator()): Set up disable_mask appropriately. Constant
	propagation now works, but isn't used yet.

	* src/ShBitSet.cpp (full): Implement full.
	(empty): Implement empty.

	* src/ShBitSet.hpp: Add full and empty member functions.

	* src/ShStatement.cpp (ShStatement): Implement ShStatement copy
	constructor, cloning info items using new clone() member function.

	* src/ShStatement.hpp (destroy_info): Fix destroy_info to iterate
	correctly.
	(class ShStatementInfo): Add clone() virtual member function.
	(class ShStatement): Add explicit copy constructor.

	* src/ShOptimizations.cpp: Added lots of code for constant
	propagation.

2004-08-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizations.cpp: Implementation file for the new
	tuple-aware optimizer.

	* src/ShOptimizations.hpp: Header file for the new tuple-aware optimizer.

2004-08-18  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/GlBackend.hpp: Check for __APPLE__ when including
	opengl headers.

	* backends/gl/Arb.cpp: Let GlBackend.hpp include our GL headers
	for us.

	* src/ShInstructions.cpp: Define exp10f on OSX.

	* config/gl.m4: Look for either <GL/gl.h> or <OpenGL/gl.h> for
	MacOS X.

	* src/ShInstructions.cpp: Fix exp10f on WIN32. Thanks to Evan Wies
	for pointing this out.

2004-08-04  Kevin Moule  <krmoule@cgl.uwaterloo.ca>

	* util/ShNoiseImpl.hpp: fixed random number generation under Win32.

2004-07-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.cpp (allocateRegister): Instead of
	asserting, use shError() when we're out of temporaries. Resolves
	issue139.

	* src/ShLibMatrix.hpp: Moved (and renamed) inverse, adjoint,
	transpose, cofactors and det here. Resolves issue94.
	Added diag and rowmat. Resolves issue98 and half of issue97.

	* Added copyright statements to the heads of all the files that
	were missing.

	* src/ShLibMatrix.hpp: Added operator* for existing matrix
	multiplication functions. Resolves issue92.
	Added row vector / matrix multiplication. Resolves issue93.

	* src/ShProgram.hpp: Added introspection iterators. Resolves issue37.

	* src/ShProgramNode.hpp: Added introspection iterators.

	* src/ShLibMisc.hpp: Rename kill to discard. Resolves issue83.

	* src/ShLibArith.hpp: Added expm1 and logp1. Resolves issue81.

	* backends/gl/ArbEmit.cpp: Added emit_csum and emit_cmul functions
	and table entries.

	* src/ShLibClamp.hpp: Added unary min and max. Resolves issue61.

	* src/ShLibArith.hpp: Added sum and prod. Resolves issue46 and
	issue47.

	* src/ShLibGeometry.hpp: Added distance* and length*. Resolves
	issue69, issue70, issue71, issue72.

	* src/ShStatement.hpp: Added SH_OP_CSUM and SH_OP_CMUL.

2004-07-19  Bryan Chan <b8chan@uwaterloo.ca>
  Changes in progress for adding extra storage types to Sh.
  Current copy is still non-working.

  * ShCloak*: Polymorphic tuple data containers that 
  ShVariableNode now uses in place of float[]

  * ShEval*: Evaluators for Cloaks.

  * ShTypeInfo*:  
  Type specific information (true/false values, default ranges, etc.)
  Also holds the evaluator and  Cloak factory.

  * ShContext*:
  Handles mappings between type strings, ShTypeInfo objects, and runtime
  generated type indices.

  * ShTransformer* :
  Moronic implementation right now only converts ops on other floating point
  types to single precision float.  Other types still TODO.

2004-07-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShLibClamp.hpp: Undef max and min if they are defined.

	* backends/gl/GlBackend.cpp (setContext): Fix assertion.

	* backends/gl/ArbEmit.cpp: Add some stuff missing on win32.

	* backends/gl/ArbBackend.cpp: Add a DllMain for win32.

	* backends/gl/Arb.cpp: Include windows.h on win32.

	* backends/gl/Makefile.win32: Added Makefile for win32.

2004-07-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShTransformer.cpp: Get rid of some more stack-based variable
	array initializers.

	* src/ShSyntax.cpp (shInit): Empty for now.

	* src/ShOptimizer.cpp: Only output node block in DumpRch if
	SH_DEBUG is enabled.

	* src/ShInstructions.cpp: Use new instead of stack-based
	variable-sized arrays.

	* src/ShImage.cpp: Include <cmath> for sqrt.

	* util/Makefile.win32: Added Win32 Makefile.

	* src/Makefile.win32: Added Win32 Makefile.

	* win32.mk: Added global win32 make settings.

	* test/sandbox/Makefile.win32: Added Win32 makefile.

2004-07-17  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariable.hpp (ShVariable): Add operator!=.

	* src/ShSwizzle.cpp (ShSwizzle): Implement default constructor.

	* src/ShSwizzle.hpp (ShSwizzle): Add default constructor.

	* src/ShStructural.cpp (ShStructural): Rewrote cycle discovery code.
	(ShStructural): Fix duplicate removal code.

	* backends/gl/GlTextures.cpp (shGlInternalFormat): Use
	GL_FLOAT_RGBA_NV for 2-component floating-point textures with
	NV_float_buffer so that the appropriate components are extracted.

	* backends/gl/PBufferStreams.cpp (execute): Added fragment program
	dumping code.

	* backends/gl/ArbCode.cpp (print): Handle condition codes.
	(allocTemps): Allocate temporaries (mostly) correctly in the
	presence of REPs.

	* backends/gl/ArbInst.hpp (ArbInst): Add condition code data.

	* backends/gl/ArbEmit.cpp: Use emit_div even on NV40, because we
	found a bug with DIV in the drivers.
	(emit_nvcond): Use condition-codes for COND instructions on NV backends.
	(emit_tex): Fixed texture lookups, in particular for 2-tuple textures.

2004-07-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbInst.hpp: Add an "invert" field for BRKs.

	* backends/gl/ArbCode.cpp (genStructNode): Handle SELFLOOPs.

	* src/ShStructural.cpp: Implement "reach under" set computation
	and therefore handle while and do loops. Yay!

	* backends/gl/ArbInst.cpp (arbOpInfo): Add info for REP, BRK and ENDREP.

	* backends/gl/ArbInst.hpp: Add REP, BRK and ENDREP.

	* backends/gl/ArbCode.cpp: Support generation of REP statements
	for while loops. Emit proper code for REP, BRK and ENDREP.
	(allocTemps): Handle loops in the
	allocator. It's not graph colouring, but it works and it's not
	completely stupid either :).

2004-07-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.cpp: Implement conditionals using IF on the
	NV40 using the new Structural Analysis discovery code.

	* backends/gl/ArbCode.hpp: Add genStructNode() prototype.

	* backends/gl/ArbInst.cpp (arbOpInfo): Operation info for IF,
	ELSE, ENDIF.

	* backends/gl/ArbInst.hpp: Add IF, ELSE, ENDIF.

	* src/ShStructural.cpp: Implementation of Structural Analysis algorithm.

	* src/ShStructural.hpp: Added Structural Analysis
	algorithm. Doesn't do loops yet.

	* test/sandbox/Makefile: Improve Makefile overall, add dependencies.

	* src/ShSwizzle.hpp: Added comparison (==) operator.

	* src/ShVariable.hpp: Added comparison (==) operator.

2004-07-13  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShSyntax.hpp (SH_NAME): Added this macro.

2004-07-12  Gabriel Moreno-Fortuny  <gmoreno@fezzik.cgl.uwaterloo.ca>

	* backends/cpu/CPU.cpp: Added -O2 flag to CPU execution.

2004-07-12  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/cpu/CPU.cpp: Rename the functions starting with __ to
	functions starting with sh_gcc_backend_.
	(encode): Link with libshcpu for the lookup functions. Resolves issue145.

	* src/ShParser.cpp (parseDo): Until means until, not
	while. Resolves issue144.

2004-07-10  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* test/sandbox: Added sandbox directory for simple tests.

	* src/scripts/semantic.py (Class.assignments): Add operatxor=(T)
	for single element types.
	(Impl.assignments): Implement operator=(T) for single element
	types. Resolves issue141.

	* src/ShGenericImpl.hpp: Implemented operator=(T).

	* src/ShGeneric.hpp: Added operator=(T) to 1-element generic.

2004-07-09  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.cpp (print): Add LABEL and BRA printing cases.
	(getLabel): Implement this function.
	(genNode): Handle branches for NVVP2.

	* backends/gl/ArbCode.hpp: Add label map.

	* backends/gl/ArbInst.cpp (arbOpInfo): Clean up table, add BRA and
	LABEL info.

	* backends/gl/ArbInst.hpp: Add instructions for BRA and a fake
	LABEL instruction.
	(ArbOpInfo): Remove useless members (fp, vp, vector).

	* backends/cpu/CPU.cpp (encode): Implement SH_OP_SGN.

	* src/ShLibDerivImpl.hpp (fwidth): Fix this function (use "var"
	instead of "t").

	* src/ShLibClampImpl.hpp (sign): Implemented this
	function. Resolves issue60.

	* src/ShLibClamp.hpp: Added sign() function.

	* src/ShInstructions.cpp (shSGN): Implemented this function.

	* src/ShInstructions.hpp: Added shSGN() function.

2004-07-08  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbEmit.cpp: Added rules for SH_OP_SGN.
	(emit_sgn): Implemented this function.
	(emit_mod): Use SH_OP_SGN.

	* backends/gl/ArbCode.hpp (ArbCode): Added emit_sgn() member function.

	* src/ShStatement.cpp: Added opInfo for SGN.

	* src/ShStatement.hpp: Added SH_OP_SGN statement.

	* backends/gl/ArbInst.hpp: Added SGT, SLE, SFL, STR, RFL, SSG
	instructions.

	* backends/gl/ArbInst.cpp (arbOpInfo): DP2 is a collectingOp.
	(arbOpInfo): Added SGT, SLE, SFL, STR, RFL, SSG instructions.

	* backends/gl/ArbEmit.cpp: Only turn three-vector normalizations
	into NRM instructions (on nvfp2).

	* backends/gl/ArbCode.cpp (ArbCode): Initialize m_environment
	using GL_EXTENSIONS information.

	* backends/gl/ArbCode.hpp: Move filters here from ArbEmit.cpp.
	(class ArbCode): Add m_environment member.

	* util/ShNoiseImpl.hpp (perlin): Avoid using a cond here, use lerp
	instead. Approximately 35% speedup for marble :).

2004-07-07  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbEmit.cpp: Add a delay_mask transformation to do
	the writemasking of a statement in a separate assignment. Use this
	for texture lookups. Resolves issue58.

	* backends/gl/ArbCode.cpp (genNode): Use emit function to generate code.
	(printVar): Fix the way destination writemasks are emitted.

	* backends/gl/ArbCode.hpp: Add emit* functions.

	* backends/gl/ArbEmit.cpp: Add new table-driven emit code.

2004-07-06  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbCode.cpp (genNode): Handle SH_OP_SNE.

2004-07-05  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* Resolved issue43.

	* backends/cpu/CPU.cpp (encode): Allow scalar ADD and DIV on both
	sides, clean up implementation of MUL.

	* backends/gl/ArbCode.cpp (genNode): Allow scalar versions of OP_ADD.
	(genDiv): Allow scalar left-hand side in division.

	* src/scripts/semantic.py (Class.modifying): Add declarations for
	scalar versions of operator+= and operator-=.
	(Impl.modifying): Add implementations for scalar versions of
	operator+= and operator-=.

	* src/ShGenericImpl.hpp: Implemented scalar versions of modifying
	arithmetic operators.

	* src/ShGeneric.hpp (class ShGeneric): Added scalar versions of
	modifying arithmetic operators.

	* src/ShInstructions.cpp (shADD): Allow scalars on both sides.
	(shDIV): Allow scalars on both sides.

	* src/ShLibArithImpl.hpp: Implemented scalar versions of
	arithmetic operators.

	* src/ShLibArith.hpp: Added scalar versions for both sides of
	operator+, operator- and operator/.

	* src/ShLibGeometryImpl.hpp (refract): Implement refract. Resolves issue73.

	* src/ShLibGeometry.hpp: Add refract function prototype.

	* src/scripts/semantic.py (Class.modifying): Add operator%=.
	(Impl.modifying): Implemented operator%=. Resolves other half of issue45.

	* src/ShGenericImpl.hpp (operator%): Implemented operator%=.

	* src/ShGeneric.hpp (class ShGeneric): Add operator%=.

	* src/ShLibClampImpl.hpp: Implemented operator%. Resolves half of issue45.

	* src/ShLibClamp.hpp: Added operator%.

	* src/ShInterp.hpp: Added ShInterp<L> texture trait wrapper
	template. Resolves issue38.

	* src/ShLibClampImpl.hpp (sat): Implement sat. Resolves issue62.

	* src/ShLibClamp.hpp: Add sat function.

	* util/ShFunc.hpp: Remove clamp functions.

	* src/ShLibClampImpl.hpp (clamp): Implement. Resolves issue55.

	* src/ShLibClamp.hpp: Add clamp library function.

	* src/ShLibGeometryImpl.hpp (lit): Implement this function.
	(faceforward): Implement this function.
	Resolves one more part of issue73.

	* src/ShLibGeometry.hpp: Add faceforward() and lit() library functions.

	* src/ShProgram.hpp: Add describe_interface() member function wrapper.

	* src/ShProgramNode.hpp: Rename operator<< for VarLists to static
	member function "print" of ShProgramNode, add describe_interface
	member function.

	* src/ShProgramNode.cpp (describe_interface): Implement this
	function. Resolves issue18.

	* src/ShVariableNode.cpp (shBindingTypeName): Change name of temp
	types to the empty string.

2004-06-30  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShLibGeometryImpl.hpp (reflect): Implemented reflect
	function. Makes issue73 in progress.

	* src/ShLibGeometry.hpp: Added reflect function.

	* backends/cpu/CPU.cpp (encode): Handle RCP and RSQ.

	* test/regress/regress.py (tests): Add tests for RCP, RSQ and SQRT.

	* backends/gl/ArbCode.cpp (genNode): Handle RCP and RSQ.

	* src/ShInstructions.cpp: Implement shRCP() and shRSQ().

	* src/ShInstructions.hpp: Add shRCP() and shRSQ().

	* src/ShLibArithImpl.hpp: Implement rcp() and rsqrt().

	* src/ShLibArith.hpp: Add rcp and rsqrt functions.

	* src/ShStatement.cpp: Add RCP and RSQ opInfo.

	* src/ShStatement.hpp: Add RCP and RSQ operations. Fixes issue48
	and issue49, together with related changes.

	* backends/gl/ArbCode.cpp (genNode): Scalarize sqrt.

	* src/ShInstructions.cpp: Implemented shDX() and shDY().

	* src/ShInstructions.hpp: Added shDX and shDY functions.

	* src/ShStatement.cpp: Added opInfo for DX and DY.

	* src/ShStatement.hpp: Added DX and DY ops.

	* src/ShLibDerivImpl.hpp: Implemented derivative functions.

	* src/ShLibDeriv.hpp: Added derivative functions, which of course
	don't work in the backend yet. Resolves issue65, issue66, issue67
	and makes issue64 an in-progress item.

	* backends/gl/ArbCode.cpp (print): Don't print out declarations
	for textures.

	* backends/gl/ArbReg.hpp: A few changes for the constant-joining code.

	* backends/gl/ArbCode.cpp: More constant-joining goodness.

	* backends/gl/ArbCode.hpp: Add constant-joining code. Find
	constants with the same values and allocate them to the same
	register. This helps particularily on ATI and Mesa.

2004-06-25  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShClamping.hpp: Added return_type typedefs.

	* src/ShWrap.hpp: Added return_type typedefs.

	* src/ShTexture.hpp: Added return_type typedefs.

	* src/ShTable.hpp: Added return_type typedefs.

	* src/ShArray.hpp: Added return_type typedefs.

	* src/ShBaseTexture.hpp: Added return_type typedefs.

2004-06-19  Bryan Chan <b8chan@uwaterloo.ca
	* util/ShWorley*.?pp: Updated worley slightly to return all
	k-nearest results instead of returning a weighted average.
  
2004-06-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* Everywhere: Replaced ShProgram typedef with real class. Moved
	bound program list to ShContext. Moved ShEnvironment::shader to
	ShContext::parsing(), and use a stack. Move copyCtrlGraph from
	ShInternals to ShCtrlGraph and cloneProgram to
	ShProgramNode. Fixes issue3, issue4, issue13 and a bunch of things
	that should have been issues but aren't.

2004-06-04  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShLibTrig.hpp: Added a couple of trig functions.

	* test/regress/regress.py (tests): Added tests for TAN. May need
	some work, probably don't want to test crazy cases.

	* src/ShStatement.hpp: Added SH_OP_TAN.

	* src/ShInstructions.hpp: Implemented shTAN.

	* backends/gl/ArbCode.cpp (genNode): Implemented TAN, preliminarily.

	* test/regress/regress.py (tests): Test LOG, LOG2, LOG10. Together
	with backend implementations this resolves issue82.

	* backends/cpu/CPU.cpp (encode): Implement LOG, LOG2, LOG10.

	* backends/gl/ArbCode.cpp (genNode): Implement LOG, LOG2, LOG10.

	* test/regress/regress.py (tests): Test EXP, EXP2, EXP10. Together
	with backend implementations this resolves issue80.

	* backends/cpu/CPU.cpp (encode): Implement SH_OP_EXP, SH_OP_EXP2, SH_OP_EXP10.

	* backends/gl/ArbCode.cpp (genNode): Implement SH_OP_EXP, SH_OP_EXP10.

	* backends/cpu/CPU.cpp (encode): Use SH_OP_MOD instead of SH_OP_FMOD.

	* backends/gl/ArbCode.cpp (genNode): Use SH_OP_MOD instead of SH_OP_FMOD.

	* backends/sm/ShSmBackend.cpp (addBasicBlock): Use SH_OP_MOD
	instead of SH_OP_FMOD.

	* src/ShNibblesImpl.hpp: Rename fmod to mod.

	* src/ShNibbles.hpp: Rename fmod to mod.

	* src/ShInstructions.cpp (shMOD): Rename from shFMOD().

	* src/ShInstructions.hpp: Rename shFMOD() to shMOD().

	* src/ShLibClampImpl.hpp (mod): Rename from fmod.

	* src/ShLibClamp.hpp: Rename fmod to mod. Fixes issue57.

	* src/ShLib.hpp (SH_SHLIB_USUAL_NON_UNIT_OPS_RETTYPE): Use mod
	instead of fmod.

	* src/ShStatement.hpp: Rename FMOD to MOD.

	* test/regress/Makefile (%.check): Generate log files.

	* test/regress/test.cpp (Test::Test): Implement.

	* test/regress/test.hpp: Made the Test class.

	* test/regress/regress.py: Added some more test data. Adopted to
	new Test class.

2004-06-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/cpu/CPU.cpp (encode): Fix POW to work with scalar RHS
	operands.

	* backends/gl/ArbCode.cpp (genNode): Fix POW to scalarize vector
	arguments.

	* src/ShLibGeometryImpl.hpp (operator^): Define operator^ (it's
	just cross). Fixes issue68. Gotta love low-hanging fruit.

	* src/ShLibGeometry.hpp: Declare operator^ to mean cross product.

	* src/ShLib.hpp (SH_SHLIB_USUAL_NON_UNIT_OPS_RETTYPE): Remove old
	crufty operator^ declarations. Should probably go over this whole
	thing and replace it (e.g. with Python code).

	* test/regress/regress.py: Perform tests for all operations, added
	more test data, cleaned up a few things.

2004-06-01  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* test/regress: Added start of regression test suite.

	* src/ShSyntax.cpp (shEndShader): Don't compile automatically for
	now. Need to fix this test. See issue129.

2004-06-01  Bryan Chan <b8chan@uwaterloo.ca>

	* src/ShTransformer.cpp (splitVaralist): Fixed input and output
	variable list splitting (Issue111)

	* test/longtuple.sht, test/test.header: Made test case more
	comprehensive.  Removed optimizationLevel

	* util/ShNoise*, util/ShWorley*: Changed interfaces to match book
	+ added weighted octave versions (Issue90)

	* util/ShKernelPost*: Fixed shHalftone and shNoisify kernels
	(Issue26, Issue27)

2004-05-31  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariable.hpp: Remove non-const node() accessor.

	* src/ShInternals.cpp: Don't change ShVariable::node() directly in repVar().

	* src/ShOptimizer.cpp: Don't change ShVariable::node() directly in copyValue().

	* src/scripts/ShAttribImpl.hpp.py (Impl.constructors): Use
	node/swizzle/neg ShGeneric constructor instead of setting fields
	manually.

2004-05-28  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShLibBooleanImpl.hpp: Implemented operator||, operator&&,
	operator!, as well as any and all. Resolves issue52, issue51,
	issue125, issue54 and issue53.

	* backends/gl/ArbCode.cpp (genNode): Implemented EXP, EXP2, LOG, LOG2.

	* src/ShInstructions.hpp: Added sh{EXP,LOG}{,2,10}() functions.

	* src/ShLibArith.hpp: Added {log,exp}{,2,10}
	instructions. Resolves issue80 and issue82, but not tested yet.

	* src/ShStatement.cpp: Added opInfo for SH_{EXP,LOG}{,2,10} operations.

	* src/ShStatement.hpp: Added SH_{EXP,LOG}{,2,10} operations.

	* src/ShContext.hpp: Added ShContext type. Moved optimization
	level and error throwing settings here from ShEnvironment. Changed
	uses of ShEnvironment to refer to ShContext::current() where
	appropriate. Resolves issue4, more or less.

	* Added CPtr typedefs for ShPointer<const ...> types. Resolves
	issue106.

2004-05-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShChannel.hpp: Actually make ShChannel inherit from
	ShMetaForwarder. Sigh.

	* src/ShProgram.hpp (class ShProgramNode): Use ShMeta.

	* src/ShChannel.hpp (class ShChannel): Use ShMetaForwarder.

	* src/ShVariable.hpp (class ShVariable): Use ShMetaForwarder.

	* src/ShVariableNode.hpp (class ShVariableNode): Use ShMeta.

	* src/ShBaseTexture.cpp (ShBaseTexture): Implement.

	* src/ShBaseTexture.hpp: Add ShBaseTexture class.

	* src/ShMeta.hpp, src/ShMeta.cpp, src/ShMetaForwarder.hpp,
	src/ShMetaForwarder.cpp: Added ShMeta and ShMetaForwarder
	classes. Resolves issue17.

2004-05-27  Bryan Chan <b8chan@uwaterloo.ca>

	* src/ShManipulator.hpp, test/manip.sht (shInsert): Added shInsert
	manipulator and added a corresponding test shader.
	  
2004-05-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShInstructions.cpp (CWISE_BINARY_OP): Allocate correct size
	for the destinations. This fixes a bug where left-hand-side scalar
	operations would produce incorrect values in uniform
	computations. Thanks to Gabriel Moreno for reporting this bug.

2004-05-21  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShError.hpp: Rename ShError to shError. Fix this in all
	invocations. Resolves issue9.

	* src/ShInit.cpp: Remove.

	* src/ShSyntax.cpp (shInit): Moved definition here from ShInit.cpp.

	* src/ShSyntax.hpp: Renamed ShInit as shInit and moved declaration
	here. Fixes issue105.

	* src/ShRefCount.hpp (class ShPointer): Rename ShRefCount to
	ShPointer. Also change all references to this. Resolves issue15.

	* src/ShSyntax.hpp, src/ShSyntax.cpp: Add shBind, shCompile and
	deprecate old functions with "Shader" in the names. Fixes issue1.

	* Get rid of explicit instantiation. Fixes issue103.

2004-05-20  Bryan Chan <b8chan@uwaterloo.ca>
  * sh/ShLibMisc.hpp:
  Added join library function from ref manual.

  * sh/ShNibbles.hpp:
  Added named input params from ref manual (only for binary ops).

  * util/ShWorley*: 
  Rewrote all the worley functions.  Modularized properly into
  generator and property factories (although it's still not
  flexible enough to handle non-linear combinations). 

  * util/ShNoise.hpp:
  Added a constant to the class to prevent recalculation
  of the noise texture width inverse.

2004-04-20  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* util/ShKernelLib.cpp (inputPass): Implemented inputPass().

	* util/ShKernelLib.hpp: Added inputPass().

2004-04-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShAlgebra.cpp (connect): Recover properly on error.

2004-04-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShInstructions.hpp: shFMOD() should take two parameters.

	* backends/gl/GlTextures.cpp (shGlInternalFormat): With new ATI
	drivers, floating-point textures now work on ATI. Hurrah!

	* backends/gl/PBufferStreams.cpp: Do PBuffer timings.
	Restore GLX state properly.
	(setupContext): Only setup a new context if required. This can
	still be improved.

2004-04-13  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShChannelImpl.hpp (ShChannel): Use semantic_type instead of
	special_type.

	* src/scripts/semantic.py (Class.declare_sized): Don't include
	doxygen comments for specializations.

	* src/ShBaseTexture.hpp: There's no need for ShBaseTexture*<T> to
	be refcountable.

2004-04-12  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* Once more, a gigantic patch. ShLib has been split up into
	multiple files, and ShInstructions.{c,h}pp have been added,
	providing "intrinsics" for every intermediate language
	operation. All ShLib functions use these intrinsics. Doxygen
	comments have been fixed up in many places. Compile time has been
	improved. Everything is wonderful. Hurrah!

	* src/scripts/ShAttribImpl.hpp.py (Impl.assign): Use ShGeneric's
	implementations of these functions instead of providing our own.
	No longer include ShLib.hpp.

	* src/ShGeneric.hpp (class ShGeneric): Specialize for N = 1.
	(class ShGeneric): Add scalar op*= and op/=.

	* src/scripts/ShAttribImpl.hpp.py (Impl.copycons): Use
	SH_DEBUG_ASSERT() instead of assert().

2004-04-12  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShImage.?pp: Added getNormalMap() to generate a normal map by 
	treating the image as a height field.

2004-04-08  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShQuaternionImpl.hpp: Improved code in getMatrix().

2004-04-07  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* Too many to enumerate: Wow. Big change. Several source files are
	now generated by python. In particular, ShAttrib and all the other
	semantic types are generated. See src/scripts/.
	Also, explicitly instantiate ShAttrib, ShVector, etc.
	Also, rename ShVariableN to ShGeneric and explicitly instantiate
	it.
	Also, remove ShConstant and add ShConstAttrib, etc. instead.
	This is one of a few large changes we had planned before the beta
	happens. Note that right now ShAttrib.cpp takes far too long to
	compile, but I'm working on that. Also going to be explicitly
	instantiating the bulk of ShLib soon, and probably generate
	ShLibPoint.hpp etc.

	* util/ShWorley.hpp: Fix comment.

2004-04-07  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShImage.cpp: Fixed byte ordering bug in loadPng().

2004-04-06  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShImage.hpp, src/ShImage.cpp: Added writePng16(), which writes
	16 bit png images.

2004-04-05  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariable.hpp (operator): Fix a small bug.

	* src/ShVariable.cpp (setValues): Lock the node before we call all
	the setValue functions.

	* src/ShVariableNode.hpp: Added m_locked member function.

	* src/ShVariableNode.cpp (lock): Added this function.
	(unlock): Added this function.
	(setValue): Respect locking, and call code()->updateUniform()
	directly. Hopefully this will improve immediate computation efficiency.

	* src/ShClamping.hpp: Remove now unnecessary dimension-specific trait
	wrappers.

	* src/ShWrap.hpp: Remove now unnecessary dimension-specific trait
	wrappers.

	* src/ShTexture.hpp: Add default constructors. Remove Mike's
	default sizes.

	* src/ShTable.hpp: Add default constructors.

	* src/ShArray.hpp: Add default constructors.

	* src/ShBaseTexture.hpp: Add constructors that don't take a size.

2004-04-05  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShQuaternion.hpp: Added structured comments.

2004-04-04  Michael McCool  <mmccool@uwaterloo.ca>

        * src/ShTexture.hpp: added default sizes in constructors
	* src/ShWrap.hpp: Hack to add trait wrappers for 1D, 2D, 3D.
	* src/ShClamping.hpp: Ditto.

	Lack of default constructors was making it hard to allocate
	arrays of textures.   Adding default sizes worked, but then
	also had to add default sizes to trait wrappers.   But then,
	needed different trait wrappers for each number of dimensions...
	ARRRGGH!

	I have concluded that although this works, this is NOT how we
	should do this.   I have commited this code for now but I think
	we should do something else, like make the size a template
	argument (with 0 indicating a "resizable" texture, with no
	memory initially allocated).   Then we can rip out the 1D,
	2D, 3D trait wrappers.  To discuss; maybe there is another way.

	Also added some structured comments in MANY places.   Many
	classes did't even show up under doxygen since not even the
	most minimal commenting had been done.   Also added license
	header to many files (although I think I missed some).  Noted
	a few issues here and there with "TODO".   Anyways, doxygen
	now generates much more complete documentation.

2004-04-01  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariableNode.hpp: Added size() member function to change
	size of variables. Don't use this if you're not sure what you're doing.

	* src/ShNibbles.hpp: Added dup nibble.

2004-03-30  Kevin Moule <krmoule@cgl.uwaterloo.ca>

	* backends/cpu/CPU.cpp: removed extra ")" present in OP_MAD

2004-03-30  Kevin Moule <krmoule@cgl.uwaterloo.ca>

	* backends/cpu/CPU.cpp: changed '<' to '>' in OP_COND

2004-03-30  Kevin Moule <krmoule@cgl.uwaterloo.ca>

	* backends/cpu/CPU.cpp: added sqrt to OP_NORM, implemented
	OP_TEX and OP_TEXI for a subset of texture types (more to follow)

2004-03-29  Gabriel Moreno-Fortuny  <gmoreno@fezzik.cgl.uwaterloo.ca>

	* backends/cpu/CPU.cpp (encode): Return from last block, thus not
	looping infinitely.

2004-03-25  Bryan Chan <b8chan@uwaterloo.ca>
	* util/ShKernel*:
	Rewrote the generalized vsh.
	Added other kernels into sepearte categories:
	Surface, Light, Postprocessing.

	* src/ShAlgebra.cpp:
	Added some operations on named ShPrograms
	Changed named connect/combine to automatically duplicate
	values to inputs that have matching name/type.
	Added namedAlign function (namedAlign(a, b) automatically swizzles
	position of a's outputs to match inputs of b by matching names)
	
2004-03-24  Jack Wang <jmwang@uwaterloo.ca>
	
	* src/ShQuaternionImpl.hpp: Bug fix in normalize().

2004-03-22  Kevin Moule <krmoule@cgl.uwaterloo.ca>

	* backends/cpu/CPU.cpp: Fixed scalar case for boolean operations,
	implemented OP_KIL

2004-03-22  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/arb: Remove these old files.

	* backends/gl/ArbCode.cpp (genNode): Use src[0] instead of dest
	from SH_OP_KIL to determine whether to kill the fragment.

	* src/ShStatement.hpp: Change comment for SH_OP_KIL to use src[0]
	instead of dst.

2004-03-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/PBufferStreams.cpp (execute): Use different
	ReadPixels() format depending on the output channel pitch.

	* Makefile.am: Don't make documentation if doxygen wasn't found or
	they have been disabled.

	* config/doxygen.m4: Add check for doxygen.

	* configure.ac: Add --enable-docs/--disable-docs

	* src/ShBaseTexture.hpp: Cube map textures shouldn't have
	operator[].

2004-03-18  Jack Wang <jmwang@uwaterloo.ca>
	
	* src/ShTransformer.cpp: Bug fix by Stefanus.

2004-03-17  Bryan Chan <b8chan@uwaterloo.ca>
	
	* src/ShWrap.hpp, src/ShTextureNode.hpp, backends/gl/GlTextureName.cpp:
	  Added GL_CLAMP_TO_EDGE wrap mode for textures.

	* backends/gl/ArbCode.cpp (genDiv, genNode):
	  Added codegen for normalize n-tuples for n != 3.

	* util/ShObjMesh*:
	  Removed some of the mesh processing at load time
	  (vertex consolidation, edge matching, 
	   normalization of normals) since they're not
	  needed in most cases.
	
2004-03-16  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* configure.ac: Report backends. Add ATI backend.

	* src/*, util/*, backends/gl/*: Make libsh compile without
	warnings with -Wall. Nothing serious here.

	* src/ShBaseTextureImpl.hpp (size): Fix my embarrassing bugs.

2004-03-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShTextureNode.hpp: Add setTexSize().

	* src/ShBaseTextureImpl.hpp: Call ShTextureNode::setTexSize().

	* backends/gl/UberTextures.cpp (glToShCubeDir): Fix -Wall warning.

	* backends/gl/GlTextures.cpp (glToShCubeDir): Fix -Wall warning.

	* src/ShTransformer.cpp (convertTextureLookups): Add this function
	to convert texture lookups to appropriate metrics. operator() and
	operator[] do The Right Thing on textures now.

	* src/ShTextureNode.hpp: Include a uniform to keep track of the
	texture's size.

	* src/ShBaseTexture.hpp, src/ShBaseTextureImpl.hpp: Include a size
	variable and size-setting functions.

	* backends/gl/ArbCode.cpp (generate): Set ShEnvironment::shader to
	0 after generating the code.

	* backends/cpu/CPU.cpp (encode): Include math.h in generated code. 

	* src/ShVariableNode.cpp (name): Output names for InOut variables.

2004-03-15  Kevin Moule <krmoule@cgl.uwaterloo.ca>

	* configure.ac: Added cpu backend to AC_CONFIG_FILES

	* backends/Makefile.am: Added cpu backend to SUBDIRS
		
	* backends/cpu/.cvsignore, backends/cpu/CPU.cpp, backends/cpu/CPU.hpp,
	backends/cpu/Makefile.am: Initial implementation of cpu backend
	
2004-03-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShProgram.cpp: Collect channels in collectVar().

	* src/ShProgram.hpp: Add a list of channels to ShProgramNode.

	* src/ShVariableNode.cpp (ShVariableNode): Channels are not uniform.

2004-03-11  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShNibblesImpl.hpp: Call ShProgramNode::name() for all the
	generated nibbles.

	* src/ShProgram.hpp: Added name() functions for programs.

2004-03-10  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShClamping.hpp: Added clamping modifiers.

2004-03-10  Tiberiu Stefan Popa  <stpopa@pentane.math.uwaterloo.ca>

	* src/ShStream.cpp (combine): Actually return the stream that we
	create.

2004-03-04  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShMemory.hpp (ShStorage): Add a default constructor that
	sets the timestamp to -1.

	* src/ShStream.hpp: Added an operator=() to run Backend::execute().

	* src/ShChannel.hpp: Added an operator=() to run Backend::execute().

	* backends/gl/*: Use the new context mechanism in various places.

	* backends/gl/GlBackend.hpp: Added a context mechanism to inform
	the GL backend about context changes.

	* src/ShMemory.cpp (sync): Check "local_cost < 0" instead of
	"cost < 0". This fixes a bug that caused storages not to be synced
	in certain circumstances.

	* backends/gl/PBufferStreams.cpp (execute): Update for new TextureTraits class.

	* backends/gl/GlTextures.cpp (shGlInternalFormat): Support
	unclamped floating-point textures.

	* backends/gl/GlTextureName.cpp (params): Update for new TextureTraits class.

	* src/ShOptimizer.cpp: Don't mark FETCH statements as dead.

	* src/ShNibblesImpl.hpp (access): Update for new TextureTraits class.

	* src/ShNibbles.hpp (access): Update for new TextureTraits class.

	* src/ShTexture.hpp: Update for new TextureTraits class.

	* src/ShArray.hpp: Update for new TextureTraits class.

	* src/ShTable.hpp: Update for new TextureTraits class.

	* src/ShBaseTextureImpl.hpp: Update for new TextureTraits class.

	* src/ShBaseTexture.hpp: Update for new TextureTraits class.

	* src/ShWrap.hpp: Update for new TextureTraits class.

	* src/ShTextureNode.hpp: Added TextureTraits class and made use of it.

	* test/stream_inverse.cpp: Add this test case.

	* src/ShImage.cpp (savePng): Make this work for non-4-element
	images, and remove debug statements.

2004-03-04  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShQuaternion.hpp, src/ShQuaternionImpl.hpp:
	Added multiplication with ShVector and ShNormal for convenience.

2004-03-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/ArbBackend.cpp: Use PBufferStreams.

	* backends/gl/PBufferStreams.cpp: Added pbuffer streams.

	* backends/gl/UberTextures.cpp: StorageFinder checks that pitch ==
	size instead of pitch == dims.

2004-03-02  Tiberiu Stefan Popa  <stpopa@pentane.math.uwaterloo.ca>

	* backends/gl/UberTextures.cpp (bindTexture): Use node->size()
	instead of node->dims().

	* backends/gl/GlBackend.hpp (SH_GL_CHECK_ERROR): Add file and line
	info 

	* backends/gl/UberStorage.cpp (transfer): Return true on HostUber
	transfers

2004-03-01  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/*: Fixed up ATI uberbuffer backend.

2004-02-28  Bryan Chan <b8chan@uwaterloo.ca>
	* util/*Mesh*:
	First cleanup pass.  Still not satisfied with 
	some of the kludginess, but won't waste more time 
	messing with this now.
	
2004-02-27  Bryan Chan <b8chan@uwaterloo.ca>
	* backends/gl/Makefile.am:
	Stefanus' fix for linking problems.

	* util/*Mesh*:
	Added triangulation.
	
2004-02-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/gl/*: Started GL backend abstraction, for future
	ARB-like backends on OpenGL.

	* src/ShChannelNode.cpp: ditto.

	* src/ShChannelNode.hpp: ditto.

	* src/ShChannelImpl.hpp: ditto.

	* src/ShChannel.hpp: Adopt stream code to new memory abstractions.

2004-02-27  Jack Wang  <jmwang@uwaterloo.ca>

	* src/ShQuaternion.hpp, src/ShQuaternionImpl.hpp:
	Added constructor taking a rotation matrix.

2004-02-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariable.cpp (setValues): Set m_neg to false, since we're
	setting signed values.

2004-02-26  Bryan Chan <b8chan@uwaterloo.ca>
	* util/ShMesh*, util/ShObjMesh*:
	Added half-edge mesh structure and cleaned up OBJ file reader a bit
	(still work in progress, interface will probably change)

	* src/ShAlgebra.cpp (namedConnect):
	Properly handle case where there are extra inputs & extra outputs.

	* util/ShKernelLibImpl.hpp (shVsh):
	Updated since outputs can be used as temps

	* src/ShVariable.cpp (operator<<):
	Fixed output of variables with m_neg set.
	
2004-02-23  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* util/ShKernelLibImpl.hpp: Clamp specular components in
	Specular() and Phong().

2004-02-20  Bryan Chan <b8chan@uwaterloo.ca>
	* util/ShWorley:
	Added point generator class functionality (now it animates!)
	
2004-02-19  Bryan Chan <b8chan@uwaterloo.ca>
	* util/ShUtil.hpp, util/ShUtilImpl.hpp 
	(evenOddSort, groupEvenOddSort):
	Even odd sort on tuple components.

	* util/ShNoise.hpp, util/ShNoiseImpl.hpp:
	Added cellnoise function here that reuses noise texture
	originally intended for Perlin noise.

	* util/ShWorley.hpp, util/ShWorleyImpl.hpp:
	Templatized & cleaned up worley to use cellnoise 
	& sorting functions.

	* src/ShNibbles.hpp:
	Allow binary operators to take operands of different sizes

	* util/ShKernelLib.hpp (shVshTangentSpace):
	Allow either passing in secondary tangent or generating
	it from normal x tangent.
	
2004-02-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariableNode.cpp (hasName): Implemented hasName().

	* src/ShVariableNode.hpp: Added hasName() to ShVariableNode.

	* src/ShUtility.hpp: Added the SelectType utility template.

	* src/ShLib.hpp (cond): Fix conditional assignment check.

	* src/ShSyntax.hpp (SH_DECL): Make use of ShIgnore to avoid
	warnings with -Wall.

	* src/ShUtility.hpp (ShCompileTimeChecker): Remove unnecessary
	private declarations.

	* src/ShMatrixImpl.hpp: Implemented ShMatrix metadata functions.

	* src/ShMatrix.hpp: Added metadata functions to ShMatrix.

	* src/ShVariableNode.cpp (internal): Implemented these.

	* src/ShVariableNode.hpp: Added "internal" metadata to variable
	nodes.

	* src/ShVariable.cpp (internal): Implemented internal functions.

	* src/ShVariable.hpp: Added "internal" metadata value to
	variables.

2004-02-18  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShConstantImpl.hpp: Ditto.

	* src/ShMatrixImpl.hpp: Ditto.

	* src/ShSpecialType.hpp: Make use of SH_STATIC_CHECK instead of
	ShIntEqual.

	* src/ShAttrib.hpp: Make use of SH_STATIC_CHECK instead of
	ShIntEqual.

	* src/ShLib.hpp: Make use of SH_STATIC_CHECK where we previously
	used ShCheckDims or similar.

	* src/ShUtility.hpp (ShCompileTimeChecker): Added this utility struct.
	(SH_STATIC_CHECK): Add this macro to check a static assertion, and
	if not output a (hopefully somewhat) useful diagnostic (at compile
	time).

2004-02-17  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShVariable.hpp: Added range metadata wrappers to ShVariable.

	* src/ShVariableNode.cpp (setValue): Only notify bound shaders if
	this is actually a uniform (and not, e.g. a constant).
	(range): Added range metadata to ShVariableNodes.

2004 02-17  Bryan Chan <b8chan@uwaterloo.ca>
	* src/ShTransformer.cpp (InputOutputConvertor):
	I am not fit to program. period. (fixed not knowing how to use references bug)
	
2004-02-17  Jack Wang  <jmwang@uwaterloo.ca>
	* src/ShQuaternionImpl.hpp, src/ShQuaternion.hpp:
	Added slerp (spherical linear interpolation) for ShQuaternion.

2004-02-16  Bryan Chan <b8chan@uwaterloo.ca>
	* src/ShAlgebra.hpp (operator>>):
	Removed the default templated >> operator that automatically defines
	>> whenever << is defined with one arg as ShProgram.

	* src/ShTransformer.cpp (convertInputOutput):
	Fixed mishandling of SH_INOUTs.
	
2004-02-15  Bryan Chan <b8chan@uwaterloo.ca>
	* src/ShAlgebra.cpp (connect,combine):
	Small cleanups to use STL list ops for copying inputs/outputs
	Factored out cloneProgram(ShProgram) to ShInternals.hpp

	* src/ShTransformer.?pp, src/ShBackend.?pp, src/ShProgram.cpp,
	  backends/arb/ShArb.?pp, backends/sm/ShSmBackend.?pp
	Cleaned up ShTransformer work.
	Added split input/output/inout and uniform transformations.

	* backends/ShArb.cpp (updateUniform): added split uniform support
	
	* src/ShOptimizer.cpp (solveReachDefs):
	Fixed bug (not clearing m_defNodes)
	
2004-02-13  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* Added the new memory management/texture management code. Too
	many changes to list. Should have kept changelogs while going
	along, but alas.

2004-02-13  Bryan Chan <b8chan@uwaterloo.ca>
	The last stand of the _VAR_

	* src/, util/, backend/: Changed all SH_VAR_* to SH_*

	* src/ShVariableNode.?pp, ShAlgebra.cpp, ShAttrib*,
	ShSpecialType*, ShMatrix.hpp, ShTransformer.cpp:
	Changed following SH_INOUT variables 
	  - typedefs
	  - addition to ShProgram varlists
	  - algebra connect/combine
	  - transformation for incompatible backends
	  - nibbles to use InOut types)

	* src/ShCtrlGraph.cpp: Fixed empty ShProgram problems
	(if parser gives null head/tail, CtrlGraph connects m_entry to m_exit)

	* src/ShTransformer.cpp: Added long constant tuple splitting

	* src/ShLib.hpp: Changed copycast to fillcast
	
2004-02-12  Bryan Chan <b8chan@uwaterloo.ca>
	* src/ShTransformer.?pp:
	Moved backend-specific transformations to the IR here.
	Added basic long tuple support for temporaries.
	
2004-02-12  Jack Wang  <jmwang@uwaterloo.ca>
	* backends/arb/ShArb.cpp, backends/arb/ShArb.hpp, src/ShLib.hpp:
	Implemented ASIN, ACOS and put all the trig code generation stuff into
	one function.

2004-02-10  Jack Wang  <jmwang@uwaterloo.ca>
	* backends/arb/ShArb.cpp:
	Implemented cosine and sine on the vertex shaders.

2004-02-04  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShAttribImpl.hpp, src/ShConstantImpl.hpp, src/ShSpecialType:
	Make type constructors check their size at compile time.

2004-02-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/arb/ShArbStream.cpp: Figure out which floating point
	pbuffers extension (ATI or NV) to use automatically.
	Add proper error reporting.

	* src/ShQuaternion.hpp, src/ShQuaternionImpl.hpp: Indented these
	to match the rest of Sh.

2004-02-01  Jack Wang  <jmwang@uwaterloo.ca>
	* src/ShQuaternion.?pp, src/ShQuaternionImpl.hpp:
	Made ShQuaternion a templated class, and hence renamed the cpp file to
	ShQuaternionImpl.hpp.
	
2004-02-01  Jack Wang  <jmwang@uwaterloo.ca>
	* src/ShQuaternion.?pp:
	Added ShQuaternion class with basically the same interface as the one
	in libdemo, but all methods here can be run on shaders.

2004-01-31  Bryan Chan  <b8chan@uwaterloo.ca>
	* util/ShPerlinImpl.hpp: Fixed discontinuity problems.
	  (TODO Sh should print a warning if a temporary is used before 
	   initialization...should be easy to determine after making ud-chains)
	
2004-01-30  Bryan Chan  <b8chan@uwaterloo.ca>
	* util/ShWorley.cpp (EvenOddSort): Made some changes to allow
	  more efficient dead code removal when either distances or gradients
	  are discarded

	* util/ShPerlin.hpp, util/ShPerlinImpl.hpp: Fixed the templatized
	  versions with proper casting code (but still non-working)

	* src/ShAlgebra.?pp (namedConnect, namedCombine):
	  Added connect & combine by name operations. (may be flaky)

	* util/ShKernelLib.hpp (shPhong,shTangentVsh): Cleaned up
	  with the new named combine/connect operators.

  * src/ShNibbles.hpp, ShNibblesImpl.hpp: Added name arguments 
    to give nibble inputs/outputs names (easier named connect/combine)

2004-01-30  Jack Wang  <jmwang@uwaterloo.ca>
	* src/ShNormal.hpp: Added m_isunit flag to ShNormal to identify 
	unit normals, similar to ShVector.hpp.

	* src/ShLibNormal.hpp: Modified normalize and abs to update the
	m_isunit flag.
	
2004-01-29  Jack Wang  <jmwang@uwaterloo.ca>
	* src/ShVector.hpp: Added a m_isunit flag to ShVector, this 
	required changing a number of functions so they can no longer
	be specified by the macros.

	* src/ShLib.hpp: SH_SHLIB_USUAL_OPERATIONS_RETTYPE was broken
	down to normalize, abs, and everything else.  

	* src/ShLibVector.hpp: Modified normalize and abs to update
	the new ShVector m_isunit flag as necessary.

	* src/ShSpecialType.hpp: SH_SPECIAL_TYPE_PARENT was broken down
	to OPEN, CONSTRUCTORS, NON_CONST_METHODS, CONST_METHODS, MEMBERS,
	and CLOSE to allow more flexibility.	
	
2004-01-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShRefCount.hpp (ShRefCountable): Actually, the
	ShRefCountable operator=() should not do anything. Realised this
	on the way home. Hence also removed the warning comment at the
	top, since luckily this will actually be the behaviour if a
	derived class provides a operator=() but does not call ours!

	* test/ref.sht: Added this simple test to fix bugs in reference
	counting.

	* src/ShSyntax.cpp (shEndShader): Set ShEnvironment::shader to a
	null pointer when we're done with it, possibly freeing up memory
	earlier.

	* backends/arb/ShArbStream.cpp (execute): More verbose error
	message when input arity does not match output arity.

	* backends/arb/ShArbTexture.cpp (loadDataTexture): Delete the
	new'd array that ShMemoryObject gave to us from the data()
	call. ShMemoryObject will be replaced soon, don't worry...

	* src/ShMemoryObject.cpp (ShDataMemoryObject): How about we
	actually delete the data that we allocate with new? Eh, Bryan?

	* src/ShRefCount.hpp (class ShRefCountable): Have fun recompiling!
	Add an operator=() and copy constructor to ShRefCountable, which
	set the refcount to zero, as it should be. Also added a warning at
	the top to those wishing to implement their own operator=() to
	derived classes.
	Added lots of optional debugging output. This helped me find the
	previous bug.

	* src/ShOptimizer.cpp (buildUdDuChains): Clear ud/du chains before
	we build them, in case there is some cruft in there.

2004-01-26  Bryan Chan  <b8chan@uwaterloo.ca>
	* src/ShNibbles.hpp, src/ShNibblesImpl.hpp: 
	Added some useful nibbles.

	* src/ShAttrib.hpp, src/ShSpecialType.hpp:
	Added typedefs for InputType, OutputType, and TempType for Attribs
	and special types
	
2004-01-21  Bryan Chan  <b8chan@uwaterloo.
	* src/ShRefCount.hpp: fixed count in operator=
	(was releasing ref before acquiring ref, so if the old object
	had the only pointer to the new object, the new object would be
	deleted before assignment)

	* src/ShOptimizer.cpp: small fixes to the Input/Output convertor
2004-01-21  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	The 2601-line patch of doom!
	
	* src/ShTextureNode.hpp (ShTextureDims): Add SH_TEXTURE_RECT enum
	value.

	* src/ShTexture.hpp (ShTextureRect): Add ShTextureRect.

	* src/ShSyntax.cpp (shEndShader): Only attempt to immediately
	compile vertex and fragment programs.

	* src/ShStream.hpp (ShStream): Add non-const begin() and end().

	* src/ShInternals.cpp (repVar): Remove... you guessed it, annoying
	debug output.

	* src/ShAlgebra.cpp (connect): Remove annoying debug output.
	(connect): Remove annoying debug output.
	(replaceUniform): Remove annoying debug output.

	* src/ShLib*.hpp: Add double conversion operators for constant
	types. Tremendously improve the special type macros to actually
	set up constant-overloaded library functions, etc.

	* src/ShAttrib.hpp, src/ShVariable.hpp, ...: Change ShFoo1f to
	actually be a float type, instead of a double.

	* backends/arb/ShArbStream.cpp (execute): Arb stream execution
	works now! At least on nvidia... Hooray! Aka the "Stefanus is
	allowed to sleep again" change. This was a lot more work than this
	puny little ChangeLog entry might suggest.

	* backends/arb/ShArbTexture.cpp, backends/arbShArbReg.cpp: Split
	these out of ShArb.cpp to make it a little more manageable.

	* backends/arb/ShArb.hpp: Added some classes from ShArb.cpp to
	facilitate splitting ShArb.cpp into more manageable chunks.

2004-01-20  Bryan Chan  <b8chan@uwaterloo.ca>
	* src/ShInternals.?pp: Moved ShVariableReplacer here from ShAlgebra

	* src/ShOptimizer.hpp, src/ShOptimizer.cpp, src/ShCtrlGraph.?pp: 
	Added conversion of input and output vars to temps when used 
	in computation.
	
	* util/ShPerlin.hpp, util/ShPerlinImpl.hpp: Templatized and cleaned up 
	the old Perlin code

	* util/ShKernelLib.?pp: moved nibbles outside of ShKernelLib to make
	them easier to use.
	
	* src/ShLib.hpp: Added pos, | for dot product on ShVariableN.

	* src/ShTexture.?pp: changed access operator() methods to const

	* src/ShAttrib.hpp, src/ShSpecialType.hpp: added default ValueType
		
2004-01-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* backends/arb/ShArbStream.cpp (execute): Generates fragment
	programs now. All that's left to do is wrestling with pbuffers to
	actually get the "geometry" rendered and read back. Hooray.

	* backends/arb/ShArb.cpp (printSamplingInstruction): Don't output
	a newline.
	(print): When using printSamplingInstruction, use our own line
	numberer to end the line. This will actually add line numbers to
	TEX instructions being output.

	* src/sh.hpp: Added ShChannelNode.hpp, ShChannel.hpp to the list
	of included files.

	* src/ShMemoryObject.cpp (ShDataMemoryObject::setPartialData):
	Implemented this function.

	* src/ShMemoryObject.hpp (ShDataMemoryObject): Added the
	setPartialData() function, used by ArbBackend::execute().

	* backends/sm/ShSmBackend.cpp (execute): Added an empty
	ShSmBackend::execute() imeplementation.

	* backends/arb/ShArbStream.cpp: Beginnings of an
	ArbBackend::execute() implementation.

	* backends/arb/ShArb.hpp (ArbBackend): Added ArbBackend::execute()
	prototype.

	* src/ShBackend.hpp (ShBackend): Added the execute() virtual
	function for stream programs.

	* src/ShCtrlGraph.hpp: Added constant versions of the dfs()
	algorithms.

	* src/Sh{Stream,Channel,ChannelNode}{,Impl}.{c,h}pp: Renamed
	streams to channels, stream lists to streams, removed
	ShCombinedStream, added operators to connect the new dynamic
	streams to ShPrograms, following Mike's new naming suggestions.

2004-01-18  Bryan Chan  <b8chan@cgl.uwaterloo.ca>
	* util/ShWorley.cpp: Added good worley bump-mapping
	
	* backends/ati/ShArb.?pp, backends/sm/ShSmBackend.?pp:
	Changed boolean <,<=,>,>=,==,!= operators to accept vec/vec
	and scalar/vec arguments in addition to original vec/scalar.

	* src/ShFixedManipulator.??: Rewrote these from scratch.
	  Added shDup.
	
2004-01-17  Bryan Chan  <b8chan@cgl.uwaterloo.ca>
	* src/ShFixedManipulator.??: Added shKeep, shLose
	manipulators that support combine with ShProgram and 
	other ShFixedManipulators.

	* src/ShManipulator.?pp, src/ShManipulatorImpl.hpp:
	Reworked all manipulators to take string parameters as well.           

	* src/ShSyntax.hpp, src/ShAlgebra.hpp, util/ShKernelLib.?pp: 
	Added macros to declare vars with names, and updated util 
	nibbles/kernels with names.

	* src/ShManipulatorImpl.hpp: Removed default 0 value for
	extra inputs when connecting an input manipulator
	(Reverts to old behaviour of passing through the channel)

	* src/ShAlgebra.hpp: added >> operator for replaceUniform
	* src/ShAlgebra.cpp: changed connect to handle outputs > inputs
	* src/ShLib.hpp: added pow(x, exp) function
	* src/ShProgram.?pp, src/ShVariableNode.?pp: added methods
	to print variables/variable lists for displaying algebra errors
	
2004-01-15.5  Bryan Chan  <b8chan@enora.cgl.uwaterloo.ca>
	* src/Makefile.am: Added missing headers

	* src/ShManipulator.?pp: Added input manipulation
	  (unsed input channels are given default value of 0)

	* util/ShKernelLib.hpp, util/ShKernelLibImpl.hpp,
	  util/ShKernelLib.cpp: Added a few useful kernels and nibbles

	* src/ShAlgebra.cpp: Changed connect/combine(p,q) to use
	  p's target (instead of "") if p.target == q.target
	
2004-01-15  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* test/stream.cpp: Added initial stream test.

	* src/ShAttrib.hpp (ShAttrib), src/ShSpecialType.hpp
	(ShSpecialType), ...: Added special_type.

	* src/ShStatement.hpp (ShOperation), src/ShStatement.cpp (opInfo):
	Added SH_OP_FETCH for streams.

	* src/ShStream.hpp, src/ShStreamImpl.hpp, src/ShStreamNode.hpp,
	src/ShStreamNode.cpp: Added (the start of) a stream abstraction.

	* test/algebra.sht: Use operator&() instead of operator+() for
	combine().

	* test/test.footer: Massage the control graph dump filename a bit
	to avoid libtool ugliness.

	* src/ShCtrlGraph.hpp (ShCtrlGraphNode): Add private real_dfs()
	template member function.
	(ShCtrlGraphNode::real_dfs): Renamed dfs() to real_dfs().
	(ShCtrlGraphNode::dfs): Added new dfs() function that wraps
	real_dfs() call with clearMarked().
	(ShCtrlGraph::dfs): Remove now unnecessary clearMarked() calls.

2004-01-14  Bryan Chan  <b8chan@enora.cgl.uwaterloo.ca>

	* src/ShManipulator.cpp (operator<<): Changed SEQ to ASN.

	* backends/arb/ShArb.cpp: Added SEQ operation support

	* src/ShManipulator.?pp: Bug fixes (lots of unmentionable idiocy)

	* src/ShAlgebra.cpp, ShVariableNode.?pp : Better error message 
	for invalid ShProgram connect (prints output/input types)

2004-01-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShAlgebra.cpp (copyCtrlGraph): Clear head before we do a dfs
	on it. Also, change the /new/ nodes instead of the old ones in the
	successor-changing loop. Furthermore, it would be a good idea to
	copy blocks instead of referring to old ones. Aka the "evidence
	that Stefanus can't code" patch.

2004-01-14  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShProgram.hpp, ...: Rename "shader kind" to "shader target",
	make targets strings instead of ints.

2004-01-12  Bryan Chan  <b8chan@enora.cgl.uwaterloo.ca>

	* src/ShAlgebra.cpp (replaceUniform): Implemented replaceUniform().

	* src/ShAlgebra.hpp: Added replaceUniform prototype.

2003-11-24  Bryan Chan (b8chan@cgl.uwaterloo.ca)
  
	* src/ShMemoryObject.hpp, src/ShMemoryObject.cpp, backends/arb/ShArb.cpp:
	Experimental implementation of memory objects for ber buffer support.

	* src/ShTexture.hpp, src/ShTextureImpl.hpp, src/ShTextureNode.hpp,
	src/ShTextureNode.cpp, util/ShPerlin.hpp, util/ShPerlin.cpp: Added
	3D Texture support.

2003-11-21  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizer.cpp (MoveEliminator): Don't eliminate moves
	where the RHS is negated (that's a legitimate move).
	(CopyPropagator): Assign negations properly in copy propagation.

	* src/ShAlgebra.cpp (copyCtrlGraph): Added a clearMarked() call
	before we do a DFS on the graph node that's to be copied. This
	makes Tibi's life much better.

2003-11-17 Kevin Moule (krmoule@cgl.uwaterloo.ca)

	* backends/arb/ShArb.cpp: re-added Backend instance, accidentally
	removed during WIN32 port

2003-11-16 Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* util/Makefile.am, util/Perlin.cpp, util/Perlin.hpp,
	util/ShPerlin.cpp, util/ShPerlin.hpp, util/ShUtilLib.hpp,
	util/ShWorley.cpp, util/ShWorley.hpp, util/Worley.cpp,
	util/Worley.hpp, util/shutil.hpp: fixed some include bugs in utils
	renamed utils to match other sh files

2003-11-16  Kevin Moule (krmoule@cgl.uwaterloo.ca)

	* src/ShInit.cpp: ifdef's for WIN32 only code...

	* src/Makefile.am: Added ShInit.cpp

	* backends/arb/ShArb.cpp: ifdef's for wglGetProcAddress

2003-11-14  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* util/shutil.hpp: more doc fixing

	* util/Makefile.am, util/Perlin.hpp, util/ShUtilLib.hpp,
	util/shutil.hpp: fixed some doc output bugs

	* doc/Doxyfile, doc/Makefile.am: updated for libshutil

	* config/ltdl.m4: Changed ltdl.m4 back to the version that comes
	with automake 1.4-p6

	* Makefile.am, configure.ac: Added util directory

	* backends/arb/ShArb.cpp, backends/arb/ShArb.hpp: Stefanus' fix
	for write masking. Changed dot product to accept scalars.

	* backends/sm/ShSmBackend.cpp: Changed dot to accept scalars

	* src/ShLib.hpp: Made dot product also accept scalars

	* util/Makefile.am, util/Perlin.cpp, util/Perlin.hpp,
	util/ShUtilLib.hpp, util/Worley.cpp, util/Worley.hpp: Initial
	checkin of utilities including hash functions, Perlin noise and
	Worley textures

2003-11-11  Kevin Moule (krmoule@cgl.uwaterloo.ca)

	* win32/.cvsignore, win32/sh.sln, win32/sh.suo, win32/sh.vcproj:
	WIN32 build files...

	* src/ShMatrix.hpp, src/ShMatrixImpl.hpp: cosmetic changes...

	* src/sh.hpp, src/ShInit.cpp: added ShInit function...

	* backends/arb/ShArb.cpp: sweeping changes for WIN32 build...

2003-11-06  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShMatrix.hpp: fixed shadowed template parameter compile
	warnings in gcc3.3.2

2003-10-31  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShLib.hpp: fixed bug introduced by me to fix another bug (for
	mad dimension checking)

2003-10-31  Kevin Moule (krmoule@cgl.uwaterloo.ca)

	* src/ShOptimizer.hpp: friend classes renamed to struct as per cpp
	file

	* src/ShOptimizer.cpp: unsigned changes for vector::size()

	* src/ShMatrixImpl.hpp: typo

	* src/ShMatrix.hpp: proper syntax for template friend functions

	* src/ShDomTree.hpp: missing header file for std::find()

	* src/ShBitSet.cpp: operator= missing return values...

	* src/ShAlgebra.cpp: for scoping rules for WIN32...

2003-10-30  Kevin Moule (krmoule@cgl.uwaterloo.ca)

	* backends/arb/ShArb.hpp: ArbInst/ArbReg are structs not classes...

	* src/ShVariableNode.cpp: cleanup for warnings generated under WIN32...

	* src/ShToken.hpp: ShTokenArgument is actually a struct...

	* src/ShSwizzle.cpp: warnings and improper C++ syntax under WIN32...

	* src/ShImage.cpp: binary mode fopen needed for WIN32

	* src/ShBitSet.cpp: cleanup for WIN32 warnings...

	* src/ShBackend.cpp: WIN32 changes for ltdl...

2003-10-24  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShAlgebra.cpp: small fix because I can't tell the difference
	  between != and ==

	* src/ShLib.hpp: Added dimension checks for mad, lerp, fmod

	* src/ShLinearAllocator.cpp: Changed linear allocator to use
	multiset

2003-10-22  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* backends/arb/ShArb.cpp, backends/sm/ShSmBackend.cpp, src/ShLib.hpp,
	src/ShStatement.cpp, src/ShStatement.hpp: Added mad (Multiply & Add)
	operation

2003-10-17  Gabriel Renaud (g2renaud@cgl.uwaterloo.ca)

	* src/ShAttrib.hpp, src/ShDomTree.cpp, src/ShDomTree.hpp,
	src/ShMatrix.hpp, src/ShMatrixImpl.hpp, src/ShVariable.cpp,
	src/ShVariable.hpp: Change ShMatrix.hpp, ShAttrib, and ShVariable,
	so that we have matrix operations and output on the console

2003-10-16  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShLib.hpp, src/ShStatement.cpp, src/ShStatement.hpp: Added
	floor, ceil, lerp, fmod.

	* backends/sm/ShSmBackend.cpp: Added ceil, floor, fmod, lerp ops

	* backends/arb/ShArb.cpp, backends/arb/ShArb.hpp: Added abs, ceil,
	floor, fmod, lerp, sle, and sge ops.  Added sin/cos not implemented
	warnings in vertex programs

2003-10-15  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShLinearAllocator.cpp: Fixed allocation for common
	starters/enders

2003-10-13  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShOptimizer.cpp: Backed out changes for error messages

2003-10-08  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* src/ShError.cpp, src/ShError.hpp: Added improved error handling

2003-10-06  Bryan Chan (b8chan@cgl.uwaterloo.ca)

	* backends/sm/ShSmBackend.cpp, src/Makefile.am, src/ShAlgebra.cpp,
	src/ShBitSet.cpp, src/ShEnvironment.cpp, src/ShEnvironment.hpp,
	src/ShException.cpp, src/ShException.hpp, src/ShImage.cpp,
	src/ShOptimizer.cpp, src/ShParser.cpp, src/ShProgram.cpp,
	src/ShSwizzle.cpp, src/ShTokenizer.cpp: Added ShError for error
	handling
	
2003-09-02  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* test/*.sht: Update to use new program specification syntax.
	
	* src/ShBackend.hpp: Make generateCode() take a program kind.

	* backends/arb/ShArb.hpp: Update backend to take program kind in
	generateCode().

	* backends/sm/ShSmBackend.hpp: Update backend to take program kind
	in generateCode().

	* src/ShAlgebra.cpp (connect, combine): Allow generic programs and
	determine the resulting program kind appropriately.

	* src/ShAlgebra.hpp: Use generic programs in lose and keep.

	* src/ShSyntax.cpp (shCompileShader): Add bodies for
	shCompileShader.

	* src/ShSyntax.hpp (SH_VERTEX_PROGRAM, SH_FRAGMENT_PROGRAM):
	Rename to these instead of SH_{VERTEX,FRAGMENT}_SHADER.
	(SH_BEGIN_VERTEX_PROGRAM, SH_BEGIN_FRAGMENT_PROGRAM): Add these.
	(SH_BEGIN_PROGRAM): Allow generic programs (without kinds).
	(shCompileShader): Add these functions.

	* src/ShProgram.hpp, src/ShProgram.cpp: Make shader kinds optional.

2003-08-27  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShAlgebra.hpp: Added operator<<, operator+, lose and keep.

	* src/ShAlgebra.cpp: Added operator<< and operator+ for programs.

	* src/ShOptimizer.hpp, src/ShOptimizer.cpp: Added straightening.
	Loop over optimizations until a fixed point is reached.

	* src/ShCtrlGraph.hpp: Added constructor taking a tail and a head,
	for the ShAlgebra operations.

	* src/sh.hpp: Added ShAlgebra.hpp to included files.

	* src/ShAlgebra.cpp, src/ShAlgebra.hpp: Added combine and connect
	functions.

2003-08-26  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShBitSet.hpp, src/ShBitSet.cpp: Added operator== and operator!=.

	* src/ShLib.hpp (kill): Pass in the extra argument to SH_OP_KIL.

	* src/ShStatement.cpp: Make KIL take one (ignored) argument. This
	is useful for the optimzer. Added OPTBRA instruction info.

	* src/ShStatement.hpp: Data structures for ud/du chains, added
	OPTBRA instruction for the optimizer. Use src[3] instead of src1,
	src2, src3 in ShStatement.

	* src/ShOptimizer.cpp, src/ShOptimizer.hpp: Added du/ud-chain
	construction and dead code elimination. Lots and lots of code.

2003-08-25  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/Makefile.am (CXXFLAGS): Enable optimizations.

	* src/ShStatement.hpp: Add an XPD statement.

	* src/ShVariableNode.cpp (ShVariableNode): Initialize variables
	with 0 in each element.

	* src/ShMatrixImpl.hpp (ShMatrix): Initialize matrices with
	identity matrices.

	* src/ShLib.hpp (cross): Add a cross product routine for 3-tuples.

2003-08-22  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizer.cpp (copyValue): Improve efficiency slightly.

	* test/bitset.cpp: Added simple bitset test.

	* src/ShBitSet.cpp, src/ShBitSet.hpp: Added ShBitSet class for the
	optimizer.

2003-08-20  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShStatement.cpp (operator<<): Print negations.

	* src/ShBasicBlock.hpp (ShBasicBlock::erase): Return the result of
	the erase operation (i.e. the iterator one past the erased element).

	* src/ShOptimizer.cpp: Improved the iterate-erase loops used in
	the optimizations.

2003-08-19  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShOptimizer.cpp (struct TempFinder): Mark temporaries used
	in branches as necessary.

	* src/ShEnvironment.hpp (struct ShEnvironment): Added the
	optimizationLevel variable indication the level of
	optimizations. Set this to 1 to turn on optimizations.

	* src/ShSyntax.cpp (shEndShader): Run the optimizer after parsing.

	* src/ShOptimizer.hpp, src/ShOptimizer.cpp: Added (simple) copy
	propagation, "move elimination" and unused temporary removal.

2003-08-11  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShAttrib.hpp (operator+=, operator-=): Added these operators
	for Attrib1's to once again avoid having to wrap constants in
	ShConstant1f()s.

	* src/ShLib.hpp: Added SH_SHLIB_CONST* macros and calls to these
	to allow scalar constants in operations not have to be wrapped in
	ShConstant1f(). This should make using the library _far_ more
	convenient :).

2003-08-08  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* src/ShLib.hpp (cond): Allow scalar cond().

	* backends/sm/ShSmBackend.cpp (addBasicBlock): Support scalar COND instructions.

	* backends/arb/ShArb.cpp (genNode): Support scalar COND instructions.

2003-08-07  Stefanus Du Toit  <sjdutoit@uwaterloo.ca>

	* configure.ac, bootstrap, config/*.m4: Split off some useful
	utility functions into their own M4 files, making the configure.ac
	slightly less verbose.

	* doc/Makefile.am: Added proper rules to build the documentation
	and install/upload it as well.
