// -*- C++ -*-
ShAttrib1f julia_max_iter = 20.0;
ShAttrib1f julia_scale = 0.05;
ShAttrib2f julia_c(1.0, -0.3);

ShTexture2D<ShColor3f> julia_map(20, 1);

ShShader shader = SH_BEGIN_SHADER(1) {
  ShInputTexCoord2f u; NAME(u);
  ShInputPosition2f pdxy; NAME(pdxy);

  ShOutputColor3f fc; NAME(fc);

  ShAttrib1f i = 0.0; NAME(i);
  SH_WHILE((dot(u, u) < ShConstant1f(2.0)) * (i < julia_max_iter)) {
    ShTexCoord2f v; NAME(v);
    v(0) = u(0)*u(0) - u(1)*u(1);
    v(1) = ShConstant1f(2.0) * u(0) * u(1);
    u = v + julia_c;
    i += ShAttrib1f(1.0);
  } SH_ENDWHILE;

  ShTexCoord2f lookup(0.0, 0.0); NAME(lookup);
  lookup(0) = julia_scale * i;
  fc = julia_map(lookup);
  
} SH_END_SHADER;
