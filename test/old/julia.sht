// -*- C++ -*-
ShAttrib1f julia_max_iter = 20.0;
ShAttrib1f julia_scale = 0.05;
ShAttrib2f julia_c(1.0, -0.3);

ShTexture1D<ShColor3f> julia_map(20);

ShProgram shader = SH_BEGIN_FRAGMENT_PROGRAM {
  ShInputTexCoord2f u; NAME(u);
  ShInputPosition2f pdxy; NAME(pdxy);

  ShOutputColor3f fc; NAME(fc);

  ShAttrib1f i = 0.0; NAME(i);
  SH_WHILE((dot(u, u) < 2.0) * (i < julia_max_iter)) {
    ShTexCoord2f v; NAME(v);
    v(0) = u(0)*u(0) - u(1)*u(1);
    v(1) = 2.0 * u(0) * u(1);
    u = v + julia_c;
    i += 1.0;
  } SH_ENDWHILE;

  fc = julia_map(julia_scale * i);
  
} SH_END_PROGRAM;
